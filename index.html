<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFT Arbitragem Autom√°tica - BSC</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Arial', sans-serif; 
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white; 
            min-height: 100vh;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        .header { 
            text-align: center; 
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .card { 
            background: rgba(255,255,255,0.1); 
            padding: 25px; 
            border-radius: 15px; 
            margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
        }
        .btn { 
            background: linear-gradient(45deg, #f0b90b, #d4a306);
            color: black; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 8px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .btn:hover { 
            background: linear-gradient(45deg, #d4a306, #b38f05);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(240, 185, 11, 0.4);
        }
        .btn:disabled { 
            background: #666; 
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }
        .btn-success {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
        }
        .input-group { 
            margin: 15px 0; 
        }
        label { 
            display: block; 
            margin-bottom: 8px;
            font-weight: bold;
            color: #f0b90b;
        }
        input, select { 
            width: 100%; 
            padding: 12px; 
            border-radius: 8px; 
            border: 1px solid #444; 
            background: rgba(0,0,0,0.3); 
            color: white; 
            font-size: 16px;
        }
        .status { 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0; 
            border-left: 5px solid;
        }
        .success { 
            background: rgba(46, 204, 113, 0.2); 
            border-left-color: #2ecc71;
        }
        .error { 
            background: rgba(231, 76, 60, 0.2); 
            border-left-color: #e74c3c;
        }
        .info { 
            background: rgba(52, 152, 219, 0.2); 
            border-left-color: #3498db;
        }
        .warning { 
            background: rgba(241, 196, 15, 0.2); 
            border-left-color: #f1c40f;
        }
        .grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 25px; 
        }
        @media (max-width: 768px) { 
            .grid { grid-template-columns: 1fr; } 
        }
        .nft-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .stat-card {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #f0b90b;
        }
        .auto-mode {
            background: rgba(46, 204, 113, 0.1);
            border: 2px solid #2ecc71;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #f0b90b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ NFT Arbitragem Autom√°tica - BSC</h1>
            <p>NFT que executa automaticamente arbitragens com Flash Loans</p>
        </div>

        <div class="grid">
            <!-- Conex√£o Wallet -->
            <div class="card">
                <h3>üîó Conex√£o Wallet</h3>
                <div class="input-group">
                    <button class="btn" id="connectWallet">Conectar MetaMask</button>
                </div>
                <div id="walletInfo" style="display: none;">
                    <p><strong>Conectado:</strong> <span id="walletAddress"></span></p>
                    <p><strong>Saldo BNB:</strong> <span id="bnbBalance"></span></p>
                    <p><strong>Rede:</strong> <span id="networkInfo"></span></p>
                </div>
            </div>

            <!-- Gerenciar NFT -->
            <div class="card">
                <h3>üé® Meu NFT de Arbitragem</h3>
                <div class="input-group">
                    <button class="btn" id="mintNFT">Criar Novo NFT</button>
                    <button class="btn" id="loadNFT">Carregar Meu NFT</button>
                </div>
                <div id="nftInfo" style="display: none;">
                    <div class="nft-stats">
                        <div class="stat-card">
                            <div>üí∞ Lucro Total</div>
                            <div class="stat-value" id="totalProfit">0 USDT</div>
                        </div>
                        <div class="stat-card">
                            <div>‚úÖ Trades Sucedidos</div>
                            <div class="stat-value" id="successfulTrades">0</div>
                        </div>
                        <div class="stat-card">
                            <div>‚ùå Trades Falhos</div>
                            <div class="stat-value" id="failedTrades">0</div>
                        </div>
                        <div class="stat-card">
                            <div>‚ö° Status</div>
                            <div class="stat-value" id="nftStatus">Inativo</div>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <button class="btn btn-success" id="withdrawProfit">Retirar Lucros</button>
                        <button class="btn" id="toggleNFT">Ativar NFT</button>
                    </div>
                </div>
            </div>

            <!-- Controle de Arbitragem -->
            <div class="card">
                <h3>‚ö° Controle de Arbitragem</h3>
                <div class="input-group">
                    <button class="btn btn-success" id="singleArbitrage">Executar Uma Arbitragem</button>
                    <button class="btn btn-danger" id="stopArbitrage">Parar Auto-Modo</button>
                </div>
                
                <div class="auto-mode">
                    <h4>üîÑ Modo Autom√°tico</h4>
                    <div class="input-group">
                        <label>Intervalo entre tentativas (segundos):</label>
                        <input type="number" id="intervalTime" value="30" min="10">
                    </div>
                    <button class="btn btn-success" id="startAutoArbitrage">
                        <span id="autoLoading" style="display: none;" class="loading"></span>
                        Iniciar Auto-Modo
                    </button>
                    <p><small>O NFT tentar√° arbitragens automaticamente enquanto estiver ativo</small></p>
                </div>
            </div>

            <!-- Estat√≠sticas em Tempo Real -->
            <div class="card">
                <h3>üìä Estat√≠sticas em Tempo Real</h3>
                <div id="liveStats">
                    <p>üîÑ <strong>√öltima Tentativa:</strong> <span id="lastAttempt">Nenhuma</span></p>
                    <p>‚è∞ <strong>Pr√≥xima Tentativa:</strong> <span id="nextAttempt">-</span></p>
                    <p>üí∏ <strong>Taxa BNB Dispon√≠vel:</strong> <span id="bnbForFees">0 BNB</span></p>
                </div>
                <div class="input-group">
                    <button class="btn" id="depositBNB">Depositar BNB para Taxas</button>
                    <input type="number" id="bnbAmount" placeholder="Quantidade BNB" step="0.001" min="0.001">
                </div>
            </div>

            <!-- Log de Atividades -->
            <div class="card">
                <h3>üìù Log de Atividades</h3>
                <div id="activityLog" style="max-height: 300px; overflow-y: auto; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px;">
                    <p>üîµ Sistema inicializado. Conecte sua carteira para come√ßar.</p>
                </div>
                <button class="btn" id="clearLog">Limpar Log</button>
            </div>

            <!-- Informa√ß√µes do Contrato -->
            <div class="card">
                <h3>üîß Informa√ß√µes do Sistema</h3>
                <div id="contractInfo">
                    <p><strong>üí∞ Empr√©stimo Flash:</strong> 1,000 USDT</p>
                    <p><strong>üéØ Estrat√©gia:</strong> USDT ‚Üí BUSD ‚Üí USDT</p>
                    <p><strong>‚ö° Protocolo:</strong> PancakeSwap Flash Loans</p>
                    <p><strong>üìà Lucro M√≠nimo:</strong> 1 USDT por trade</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ABI COMPLETO E ATUALIZADO DO CONTRATO
        const CONTRACT_ABI = [
    {
        "inputs": [],
        "stateMutability": "nonpayable",
        "type": "constructor"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": true,
                "internalType": "uint256",
                "name": "tokenId",
                "type": "uint256"
            },
            {
                "indexed": false,
                "internalType": "bool",
                "name": "success",
                "type": "bool"
            },
            {
                "indexed": false,
                "internalType": "uint256",
                "name": "profit",
                "type": "uint256"
            }
        ],
        "name": "ArbitrageAttempt",
        "type": "event"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": true,
                "internalType": "uint256",
                "name": "tokenId",
                "type": "uint256"
            },
            {
                "indexed": false,
                "internalType": "bool",
                "name": "enabled",
                "type": "bool"
            },
            {
                "indexed": false,
                "internalType": "uint256",
                "name": "interval",
                "type": "uint256"
            }
        ],
        "name": "AutoModeUpdated",
        "type": "event"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": true,
                "internalType": "uint256",
                "name": "tokenId",
                "type": "uint256"
            },
            {
                "indexed": false,
                "internalType": "uint256",
                "name": "amount",
                "type": "uint256"
            },
            {
                "indexed": false,
                "internalType": "uint256",
                "name": "profit",
                "type": "uint256"
            }
        ],
        "name": "FlashLoanExecuted",
        "type": "event"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": true,
                "internalType": "address",
                "name": "owner",
                "type": "address"
            },
            {
                "indexed": true,
                "internalType": "uint256",
                "name": "tokenId",
                "type": "uint256"
            }
        ],
        "name": "NFTMinted",
        "type": "event"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": true,
                "internalType": "address",
                "name": "owner",
                "type": "address"
            },
            {
                "indexed": false,
                "internalType": "uint256",
                "name": "amount",
                "type": "uint256"
            }
        ],
        "name": "ProfitWithdrawn",
        "type": "event"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "loanAmount",
                "type": "uint256"
            }
        ],
        "name": "_executeArbitrage",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "address",
                "name": "user",
                "type": "address"
            },
            {
                "internalType": "bool",
                "name": "status",
                "type": "bool"
            }
        ],
        "name": "authorize",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "address",
                "name": "",
                "type": "address"
            }
        ],
        "name": "authorized",
        "outputs": [
            {
                "internalType": "bool",
                "name": "_value",
                "type": "bool"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "depositBNB",
        "outputs": [],
        "stateMutability": "payable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "tokenId"
            }
        ],
        "name": "executeAutoArbitrage",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "FLASH_LOAN_AMOUNT",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "address",
                "name": "token"
            }
        ],
        "name": "getContractBalance",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": ""
            }
        ],
        "name": "lastAutoAttempt",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "MIN_PROFIT",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "mintNFT",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": ""
            }
        ],
        "name": "nfts",
        "outputs": [
            {
                "internalType": "address",
                "name": "owner",
                "type": "address"
            },
            {
                "internalType": "uint256",
                "name": "totalProfit",
                "type": "uint256"
            },
            {
                "internalType": "uint256",
                "name": "successfulTrades",
                "type": "uint256"
            },
            {
                "internalType": "uint256",
                "name": "failedTrades",
                "type": "uint256"
            },
            {
                "internalType": "bool",
                "name": "isActive",
                "type": "bool"
            },
            {
                "internalType": "uint256",
                "name": "lastTradeTime",
                "type": "uint256"
            },
            {
                "internalType": "bool",
                "name": "autoMode",
                "type": "bool"
            },
            {
                "internalType": "uint256",
                "name": "autoInterval",
                "type": "uint256"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "nftCounter",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "owner",
        "outputs": [
            {
                "internalType": "address",
                "name": "",
                "type": "address"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "address",
                "name": "sender",
                "type": "address"
            },
            {
                "internalType": "uint256",
                "name": "amount0",
                "type": "uint256"
            },
            {
                "internalType": "uint256",
                "name": "amount1",
                "type": "uint256"
            },
            {
                "internalType": "bytes",
                "name": "data",
                "type": "bytes"
            }
        ],
        "name": "pancakeCall",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "tokenId",
                "type": "uint256"
            },
            {
                "internalType": "bool",
                "name": "enabled",
                "type": "bool"
            },
            {
                "internalType": "uint256",
                "name": "interval",
                "type": "uint256"
            }
        ],
        "name": "setAutoMode",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "tokenId"
            }
        ],
        "name": "startArbitrage",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "tokenId",
                "type": "uint256"
            },
            {
                "internalType": "uint256",
                "name": "amount",
                "type": "uint256"
            }
        ],
        "name": "startFlashLoanArbitrage",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "tokenId",
                "type": "uint256"
            },
            {
                "internalType": "bool",
                "name": "active",
                "type": "bool"
            }
        ],
        "name": "toggleNFT",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "address",
                "name": ""
            }
        ],
        "name": "userNFT",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "amount"
            }
        ],
        "name": "withdrawBNB",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "tokenId"
            }
        ],
        "name": "withdrawProfit",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "address",
                "name": "token",
                "type": "address"
            },
            {
                "internalType": "uint256",
                "name": "amount",
                "type": "uint256"
            }
        ],
        "name": "withdrawToken",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "stateMutability": "payable",
        "type": "receive"
    }
];

        // ENDERE√áO DO CONTRATO
        const CONTRACT_ADDRESS = "0xCF179A24237B194F65929E35Ae620081f4A6b290";

        class AutoArbitrageApp {
            constructor() {
                this.web3 = null;
                this.accounts = [];
                this.contract = null;
                this.userNFTId = null;
                this.trueAutoModeInterval = null;
                this.isTrueAutoModeRunning = false;
                
                this.init();
            }
            
            async init() {
                await this.connectWeb3();
                this.setupEventListeners();
                this.updateStatus('Sistema inicializado. Conecte sua carteira.', 'info');
            }
            
            async connectWeb3() {
                if (window.ethereum) {
                    this.web3 = new Web3(window.ethereum);
                    try {
                        this.accounts = await window.ethereum.request({ 
                            method: 'eth_requestAccounts' 
                        });
                        
                        this.updateWalletInfo();
                        await this.loadContract();
                        
                        await this.checkUserNFT();
                        
                        this.updateStatus('Carteira conectada com sucesso!', 'success');
                        
                    } catch (error) {
                        this.updateStatus('Erro ao conectar carteira: ' + error.message, 'error');
                    }
                } else {
                    this.updateStatus('Por favor, instale o MetaMask!', 'error');
                }
            }
            
            async loadContract() {
                this.contract = new this.web3.eth.Contract(
                    CONTRACT_ABI,
                    CONTRACT_ADDRESS
                );
            }
            
            setupEventListeners() {
                document.getElementById('connectWallet').addEventListener('click', () => this.connectWeb3());
                document.getElementById('mintNFT').addEventListener('click', () => this.mintNFT());
                document.getElementById('loadNFT').addEventListener('click', () => this.checkUserNFT());
                document.getElementById('singleArbitrage').addEventListener('click', () => this.executeSingleArbitrage());
                document.getElementById('startAutoArbitrage').addEventListener('click', () => this.setupTrueAutoMode());
                document.getElementById('stopArbitrage').addEventListener('click', () => this.stopTrueAutoMode());
                document.getElementById('withdrawProfit').addEventListener('click', () => this.withdrawProfit());
                document.getElementById('toggleNFT').addEventListener('click', () => this.toggleNFT());
                document.getElementById('depositBNB').addEventListener('click', () => this.depositBNB());
                document.getElementById('clearLog').addEventListener('click', () => this.clearLog());
            }
            
            updateWalletInfo() {
                if (this.accounts.length > 0) {
                    const address = this.accounts[0];
                    const shortAddress = address.substring(0, 6) + '...' + address.substring(38);
                    
                    document.getElementById('walletAddress').textContent = shortAddress;
                    document.getElementById('walletInfo').style.display = 'block';
                    
                    this.getBNBBalance();
                    this.getNetworkInfo();
                }
            }
            
            async getBNBBalance() {
                if (this.accounts.length > 0) {
                    const balance = await this.web3.eth.getBalance(this.accounts[0]);
                    const balanceEth = this.web3.utils.fromWei(balance, 'ether');
                    document.getElementById('bnbBalance').textContent = balanceEth + ' BNB';
                    document.getElementById('bnbForFees').textContent = balanceEth + ' BNB';
                }
            }
            
            async getNetworkInfo() {
                const networkId = await this.web3.eth.net.getId();
                let networkName = 'Desconhecida';
                
                if (networkId === 56) networkName = 'BSC Mainnet';
                else if (networkId === 97) networkName = 'BSC Testnet';
                else networkName = `Rede ${networkId}`;
                
                document.getElementById('networkInfo').textContent = networkName;
            }
            
            async mintNFT() {
                try {
                    this.updateStatus('Criando NFT...', 'info');
                    
                    const result = await this.contract.methods.mintNFT().send({
                        from: this.accounts[0],
                        gas: 300000
                    });
                    
                    this.updateStatus('NFT criado com sucesso!', 'success');
                    this.addToLog('‚úÖ Novo NFT de arbitragem criado');
                    
                    await this.checkUserNFT();
                    
                } catch (error) {
                    this.updateStatus('Erro ao criar NFT: ' + error.message, 'error');
                }
            }
            
            async checkUserNFT() {
                try {
                    if (!this.accounts.length) return;
                    
                    const nftId = await this.contract.methods.userNFT(this.accounts[0]).call();
                    
                    if (nftId > 0) {
                        this.userNFTId = nftId;
                        await this.loadNFTInfo();
                    } else {
                        document.getElementById('nftInfo').style.display = 'none';
                        this.updateStatus('Voc√™ n√£o possui um NFT. Crie um para come√ßar.', 'warning');
                    }
                    
                } catch (error) {
                    console.error('Erro ao verificar NFT:', error);
                }
            }
            
            async loadNFTInfo() {
                try {
                    const nftInfo = await this.contract.methods.nfts(this.userNFTId).call();
                    
                    document.getElementById('totalProfit').textContent = 
                        this.web3.utils.fromWei(nftInfo.totalProfit, 'ether') + ' USDT';
                    document.getElementById('successfulTrades').textContent = nftInfo.successfulTrades;
                    document.getElementById('failedTrades').textContent = nftInfo.failedTrades;
                    document.getElementById('nftStatus').textContent = nftInfo.isActive ? 'Ativo' : 'Inativo';
                    
                    document.getElementById('nftInfo').style.display = 'block';
                    
                    const toggleBtn = document.getElementById('toggleNFT');
                    toggleBtn.textContent = nftInfo.isActive ? 'Desativar NFT' : 'Ativar NFT';
                    toggleBtn.className = nftInfo.isActive ? 'btn btn-danger' : 'btn btn-success';
                    
                } catch (error) {
                    console.error('Erro ao carregar NFT info:', error);
                }
            }
            
            async executeSingleArbitrage() {
                try {
                    if (!this.userNFTId) {
                        this.updateStatus('Voc√™ precisa de um NFT para executar arbitragens', 'error');
                        return;
                    }
                    
                    this.updateStatus('Executando arbitragem...', 'info');
                    this.addToLog('üîÑ Iniciando arbitragem √∫nica...');
                    
                    const result = await this.contract.methods.startArbitrage(this.userNFTId).send({
                        from: this.accounts[0],
                        gas: 500000
                    });
                    
                    this.addToLog('‚ö° Arbitragem executada! Verificando resultado...');
                    
                    setTimeout(() => {
                        this.loadNFTInfo();
                        this.addToLog('üìä Resultado da arbitragem verificado');
                    }, 5000);
                    
                } catch (error) {
                    this.updateStatus('Erro na arbitragem: ' + error.message, 'error');
                    this.addToLog('‚ùå Arbitragem falhou: ' + error.message);
                }
            }
            
            async setupTrueAutoMode() {
                try {
                    const nftId = this.userNFTId;
                    const intervalSeconds = parseInt(document.getElementById('intervalTime').value);
                    
                    if (!nftId) {
                        this.updateStatus('Voc√™ precisa de um NFT para o modo autom√°tico', 'error');
                        return;
                    }
                    
                    this.updateStatus('Configurando auto-mod...', 'info');
                    
                    // 1. Configurar auto-mod no contrato
                    await this.contract.methods.setAutoMode(
                        nftId, 
                        true, 
                        intervalSeconds
                    ).send({
                        from: this.accounts[0],
                        gas: 150000
                    });
                    
                    this.updateStatus('‚úÖ Auto-mod configurado no contrato!', 'success');
                    this.addToLog('üîÑ Auto-mod configurado - aguardando execu√ß√µes...');
                    
                    // 2. Iniciar servi√ßo de polling
                    this.startTrueAutoMode(nftId, intervalSeconds);
                    
                } catch (error) {
                    this.updateStatus('Erro ao configurar auto-mod: ' + error.message, 'error');
                }
            }
            
            startTrueAutoMode(nftId, intervalSeconds) {
                if (this.trueAutoModeInterval) {
                    clearInterval(this.trueAutoModeInterval);
                }
                
                this.isTrueAutoModeRunning = true;
                document.getElementById('autoLoading').style.display = 'inline-block';
                document.getElementById('startAutoArbitrage').disabled = true;
                
                let checkCount = 0;
                
                this.trueAutoModeInterval = setInterval(async () => {
                    checkCount++;
                    this.addToLog(`üîç Verificando oportunidade #${checkCount}...`);
                    
                    try {
                        // Verificar condi√ß√µes sem gastar gas (call)
                        const nftInfo = await this.contract.methods.nfts(nftId).call();
                        const lastAttempt = await this.contract.methods.lastAutoAttempt(nftId).call();
                        const currentTime = Math.floor(Date.now() / 1000);
                        
                        if (nftInfo.autoMode && nftInfo.isActive) {
                            const timeSinceLastAttempt = currentTime - lastAttempt;
                            
                            if (timeSinceLastAttempt >= parseInt(nftInfo.autoInterval)) {
                                this.addToLog('üéØ Oportunidade detectada! Executando arbitragem...');
                                
                                // Executar arbitragem autom√°tica
                                await this.contract.methods.executeAutoArbitrage(nftId).send({
                                    from: this.accounts[0],
                                    gas: 500000
                                });
                                
                                this.addToLog('‚úÖ Arbitragem autom√°tica executada!');
                                await this.loadNFTInfo();
                            } else {
                                const waitTime = parseInt(nftInfo.autoInterval) - timeSinceLastAttempt;
                                this.addToLog(`‚è≥ Aguardando ${waitTime}s para pr√≥xima tentativa...`);
                            }
                        } else {
                            this.addToLog('‚ùå Auto-mod desativado no contrato');
                            this.stopTrueAutoMode();
                        }
                        
                        // Atualizar pr√≥ximo hor√°rio
                        const nextCheck = new Date(Date.now() + 10000);
                        document.getElementById('nextAttempt').textContent = nextCheck.toLocaleTimeString();
                        
                    } catch (error) {
                        if (error.message.includes('revert') || error.message.includes('execution reverted')) {
                            this.addToLog('‚ùå Condi√ß√µes n√£o atendidas para arbitragem');
                        } else {
                            this.addToLog('‚ùå Erro na verifica√ß√£o: ' + error.message);
                        }
                    }
                }, 10000); // Verifica a cada 10 segundos
            }
            
            stopTrueAutoMode() {
                if (this.trueAutoModeInterval) {
                    clearInterval(this.trueAutoModeInterval);
                    this.trueAutoModeInterval = null;
                }
                
                this.isTrueAutoModeRunning = false;
                document.getElementById('autoLoading').style.display = 'none';
                document.getElementById('startAutoArbitrage').disabled = false;
                
                // Desativar auto-mod no contrato
                if (this.userNFTId) {
                    this.contract.methods.setAutoMode(this.userNFTId, false, 0).send({
                        from: this.accounts[0],
                        gas: 100000
                    }).catch(() => {}); // Ignora erros se j√° estiver desativado
                }
                
                this.updateStatus('üõë Auto-mod parado', 'info');
                this.addToLog('üõë MODO AUTOM√ÅTICO PARADO');
            }
            
            async withdrawProfit() {
                try {
                    if (!this.userNFTId) {
                        this.updateStatus('Voc√™ precisa de um NFT', 'error');
                        return;
                    }
                    
                    this.updateStatus('Retirando lucros...', 'info');
                    
                    const result = await this.contract.methods.withdrawProfit(this.userNFTId).send({
                        from: this.accounts[0],
                        gas: 200000
                    });
                    
                    this.updateStatus('Lucros retirados com sucesso!', 'success');
                    this.addToLog('üí∞ Lucros retirados da conta');
                    
                    await this.loadNFTInfo();
                    
                } catch (error) {
                    this.updateStatus('Erro ao retirar lucros: ' + error.message, 'error');
                }
            }
            
            async toggleNFT() {
                try {
                    if (!this.userNFTId) return;
                    
                    const nftInfo = await this.contract.methods.nfts(this.userNFTId).call();
                    const newStatus = !nftInfo.isActive;
                    
                    await this.contract.methods.toggleNFT(this.userNFTId, newStatus).send({
                        from: this.accounts[0],
                        gas: 100000
                    });
                    
                    this.updateStatus(`NFT ${newStatus ? 'ativado' : 'desativado'}`, 'success');
                    this.addToLog(`‚ö° NFT ${newStatus ? 'ativado' : 'desativado'}`);
                    
                    await this.loadNFTInfo();
                    
                } catch (error) {
                    this.updateStatus('Erro ao alterar status do NFT: ' + error.message, 'error');
                }
            }
            
            async depositBNB() {
                try {
                    const amount = document.getElementById('bnbAmount').value;
                    
                    if (!amount || amount <= 0) {
                        this.updateStatus('Digite uma quantidade v√°lida', 'error');
                        return;
                    }
                    
                    const amountWei = this.web3.utils.toWei(amount, 'ether');
                    
                    await this.contract.methods.depositBNB().send({
                        from: this.accounts[0],
                        value: amountWei,
                        gas: 100000
                    });
                    
                    this.updateStatus(`Depositado ${amount} BNB para taxas`, 'success');
                    this.addToLog(`üí∞ Depositado ${amount} BNB para taxas de gas`);
                    
                    document.getElementById('bnbAmount').value = '';
                    await this.getBNBBalance();
                    
                } catch (error) {
                    this.updateStatus('Erro no dep√≥sito: ' + error.message, 'error');
                }
            }
            
            updateStatus(message, type) {
                const statusDiv = document.getElementById('activityLog');
                const timestamp = new Date().toLocaleTimeString();
                
                statusDiv.innerHTML += `<p><strong>[${timestamp}]</strong> <span class="${type}">${message}</span></p>`;
                statusDiv.scrollTop = statusDiv.scrollHeight;
            }
            
            addToLog(message) {
                const logDiv = document.getElementById('activityLog');
                const timestamp = new Date().toLocaleTimeString();
                
                logDiv.innerHTML += `<p><strong>[${timestamp}]</strong> ${message}</p>`;
                logDiv.scrollTop = logDiv.scrollHeight;
            }
            
            clearLog() {
                document.getElementById('activityLog').innerHTML = 
                    '<p>üîµ Log limpo. Sistema funcionando.</p>';
            }
        }
        
        // Inicializar aplica√ß√£o
        window.addEventListener('load', () => {
            window.app = new AutoArbitrageApp();
        });
    </script>
</body>
</html>
