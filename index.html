<!DOCTYPE html>
<html>
<head>
    <title>Front-Run Bot Pro - BSC</title>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js"></script>
    <style>
        :root {
            --primary: #ff6b35;
            --success: #00d26a;
            --danger: #ff0080;
            --warning: #ffb800;
            --dark: #0f0f0f;
            --darker: #0a0a0a;
            --light: #1a1a1a;
            --lighter: #2d2d2d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--dark);
            color: #fff;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary), #ff8c42);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: var(--light);
            border: 1px solid var(--lighter);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .card-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--lighter);
        }
        
        .card h3 {
            color: var(--primary);
            font-size: 1.3em;
            margin: 0;
        }
        
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn:hover {
            background: #e55a2b;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-warning {
            background: var(--warning);
            color: #000;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #ccc;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            background: var(--darker);
            border: 1px solid var(--lighter);
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: var(--lighter);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-success { color: var(--success); }
        .stat-warning { color: var(--warning); }
        .stat-danger { color: var(--danger); }
        .stat-primary { color: var(--primary); }
        
        .log {
            background: var(--darker);
            padding: 15px;
            border-radius: 8px;
            height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .log-entry {
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 5px;
            border-left: 4px solid var(--primary);
        }
        
        .log-success { border-left-color: var(--success); background: rgba(0,210,106,0.1); }
        .log-error { border-left-color: var(--danger); background: rgba(255,0,128,0.1); }
        .log-warning { border-left-color: var(--warning); background: rgba(255,184,0,0.1); }
        .log-info { border-left-color: #2196F3; background: rgba(33,150,243,0.1); }
        
        .token-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .token-item {
            background: var(--lighter);
            padding: 15px;
            margin: 8px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .monitor-item {
            background: var(--darker);
            padding: 12px;
            margin: 6px 0;
            border-radius: 6px;
            border-left: 3px solid var(--primary);
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .status-active { background: var(--success); color: #000; }
        .status-inactive { background: var(--danger); color: #fff; }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ü§ñ Front-Run Bot Professional - BSC</h1>
            <p>Sistema avan√ßado de front-running para tokens vol√°teis</p>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div>Lucro Total</div>
                <div class="stat-value stat-success" id="totalProfit">0 USDT</div>
                <div>All Time</div>
            </div>
            <div class="stat-card">
                <div>Taxa de Sucesso</div>
                <div class="stat-value stat-primary" id="successRate">0%</div>
                <div>Performance</div>
            </div>
            <div class="stat-card">
                <div>Total de Trades</div>
                <div class="stat-value stat-warning" id="totalTrades">0</div>
                <div>Execu√ß√µes</div>
            </div>
            <div class="stat-card">
                <div>Saldo USDT</div>
                <div class="stat-value stat-success" id="usdtBalance">0</div>
                <div>Dispon√≠vel</div>
            </div>
        </div>

        <div class="grid">
            <!-- Coluna Esquerda -->
            <div>
                <!-- Conex√£o e Status -->
                <div class="card">
                    <div class="card-header">
                        <h3>üîó Conex√£o & Status</h3>
                    </div>
                    <button class="btn" id="connectWallet">Conectar MetaMask</button>
                    <span id="walletStatus" class="status-badge status-inactive">Desconectado</span>
                    
                    <div class="form-group" style="margin-top: 15px;">
                        <div id="walletInfo" style="font-size: 12px; color: #ccc;"></div>
                    </div>
                </div>

                <!-- Gerenciar Tokens -->
                <div class="card">
                    <div class="card-header">
                        <h3>üí∞ Gerenciar Tokens</h3>
                    </div>
                    <div class="form-group">
                        <label>Endere√ßo do Token:</label>
                        <input type="text" id="tokenAddress" placeholder="0x..." style="font-family: monospace;">
                    </div>
                    <div class="form-group">
                        <label>Tamanho do Trade (USDT):</label>
                        <input type="number" id="tradeSize" value="50" min="10">
                    </div>
                    <div class="form-group">
                        <label>Lucro M√≠nimo (USDT):</label>
                        <input type="number" id="minProfit" value="2" min="0.5" step="0.5">
                    </div>
                    <div class="form-group">
                        <label>Slippage M√°xima (%):</label>
                        <input type="number" id="maxSlippage" value="3" min="1" max="10">
                    </div>
                    <button class="btn btn-success" id="addToken">Adicionar Token</button>
                    <button class="btn btn-warning" id="analyzeToken">Analisar Token</button>
                </div>

                <!-- Tokens Ativos -->
                <div class="card">
                    <div class="card-header">
                        <h3>üìã Tokens Ativos</h3>
                    </div>
                    <div class="token-list" id="activeTokens">
                        <!-- Tokens ser√£o listados aqui -->
                    </div>
                </div>
            </div>

            <!-- Coluna Direita -->
            <div>
                <!-- Controle do Bot -->
                <div class="card">
                    <div class="card-header">
                        <h3>üéÆ Controle do Bot</h3>
                    </div>
                    <div class="form-group">
                        <label>Gas Multiplier:</label>
                        <input type="number" id="gasMultiplier" value="1.2" min="1.1" max="3" step="0.1">
                    </div>
                    <button class="btn btn-success" id="startBot">Iniciar Bot</button>
                    <button class="btn btn-danger" id="stopBot" disabled>Parar Bot</button>
                    <button class="btn btn-warning" id="manualRun">Execu√ß√£o Manual</button>
                    
                    <div style="margin-top: 15px;">
                        <label>Status do Bot:</label>
                        <div id="botStatus" class="status-badge status-inactive">INATIVO</div>
                    </div>
                </div>

                <!-- Gerenciar Fundos -->
                <div class="card">
                    <div class="card-header">
                        <h3>üè¶ Gerenciar Fundos</h3>
                    </div>
                    <div class="form-group">
                        <label>Quantidade USDT:</label>
                        <input type="number" id="fundAmount" value="100" min="10">
                    </div>
                    <button class="btn" id="addFunds">Adicionar USDT</button>
                    <button class="btn btn-warning" id="withdrawFunds">Retirar USDT</button>
                    <button class="btn" id="approveUSDT">Aprovar USDT</button>
                </div>

                <!-- Monitor em Tempo Real -->
                <div class="card">
                    <div class="card-header">
                        <h3>üîç Monitor em Tempo Real</h3>
                    </div>
                    <div id="monitorDisplay" style="height: 200px; overflow-y: auto;">
                        <div class="monitor-item">Aguardando transa√ß√µes...</div>
                    </div>
                    <div style="margin-top: 10px; font-size: 12px; color: #ccc;">
                        <span id="monitorStats">Transa√ß√µes detectadas: 0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logs -->
        <div class="card">
            <div class="card-header">
                <h3>üìù Logs de Execu√ß√£o</h3>
                <button class="btn" id="clearLogs">Limpar Logs</button>
            </div>
            <div class="log" id="logs"></div>
        </div>
    </div>

    <script>
        // ABI DO CONTRATO - ATUALIZADA
        const contractABI = [
            {
                "inputs": [
                    {"internalType": "address", "name": "_token", "type": "address"},
                    {"internalType": "uint256", "name": "_tradeSizeUSDT", "type": "uint256"},
                    {"internalType": "uint256", "name": "_minProfitUSDT", "type": "uint256"},
                    {"internalType": "uint256", "name": "_maxSlippagePercent", "type": "uint256"}
                ],
                "name": "addToken",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "uint256", "name": "amount", "type": "uint256"}
                ],
                "name": "addUSDT",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "address", "name": "token", "type": "address"},
                    {"internalType": "uint256", "name": "tradeSize", "type": "uint256"}
                ],
                "name": "analyzeOpportunity",
                "outputs": [
                    {"internalType": "uint256", "name": "expectedProfit", "type": "uint256"},
                    {"internalType": "uint256", "name": "expectedSlippage", "type": "uint256"},
                    {"internalType": "bool", "name": "profitable", "type": "bool"}
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "address", "name": "token", "type": "address"},
                    {"internalType": "uint256", "name": "gasPrice", "type": "uint256"}
                ],
                "name": "executeFrontRun",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getActiveTokens",
                "outputs": [
                    {"internalType": "address[]", "name": "", "type": "address[]"}
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getStats",
                "outputs": [
                    {"internalType": "uint256", "name": "totalProfit", "type": "uint256"},
                    {"internalType": "uint256", "name": "totalTrades", "type": "uint256"},
                    {"internalType": "uint256", "name": "successRate", "type": "uint256"},
                    {"internalType": "uint256", "name": "usdtBalance", "type": "uint256"}
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "address", "name": "token", "type": "address"}
                ],
                "name": "getTokenConfig",
                "outputs": [
                    {"internalType": "uint256", "name": "tradeSizeUSDT", "type": "uint256"},
                    {"internalType": "uint256", "name": "minProfitUSDT", "type": "uint256"},
                    {"internalType": "uint256", "name": "maxSlippagePercent", "type": "uint256"},
                    {"internalType": "bool", "name": "active", "type": "bool"}
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "address", "name": "_token", "type": "address"}
                ],
                "name": "removeToken",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "uint256", "name": "amount", "type": "uint256"}
                ],
                "name": "withdrawUSDT",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "anonymous": false,
                "inputs": [
                    {"indexed": true, "internalType": "address", "name": "token", "type": "address"},
                    {"indexed": false, "internalType": "uint256", "name": "profit", "type": "uint256"},
                    {"indexed": false, "internalType": "uint256", "name": "gasUsed", "type": "uint256"}
                ],
                "name": "FrontRunExecuted",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {"indexed": true, "internalType": "address", "name": "user", "type": "address"},
                    {"indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256"}
                ],
                "name": "FundsAdded",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {"indexed": true, "internalType": "address", "name": "user", "type": "address"},
                    {"indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256"}
                ],
                "name": "FundsWithdrawn",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {"indexed": true, "internalType": "address", "name": "token", "type": "address"},
                    {"indexed": false, "internalType": "uint256", "name": "tradeSize", "type": "uint256"},
                    {"indexed": false, "internalType": "uint256", "name": "minProfit", "type": "uint256"}
                ],
                "name": "TokenAdded",
                "type": "event"
            }
        ];
        
        let web3, contract, userAccount;
        const contractAddress = "0xE6181879b5B845E0001ffE11E3bf076B60270bFC";
        const USDT_ADDRESS = "0x55d398326f99059fF775485246999027B3197955";

        // Estado do bot
        let isBotRunning = false;
        let botInterval;
        let detectedTransactions = 0;
        let activeTokensList = [];

        // Elementos da UI
        const elements = {
            // Coneex√£o
            connectWallet: document.getElementById('connectWallet'),
            walletStatus: document.getElementById('walletStatus'),
            walletInfo: document.getElementById('walletInfo'),
            
            // Stats
            totalProfit: document.getElementById('totalProfit'),
            successRate: document.getElementById('successRate'),
            totalTrades: document.getElementById('totalTrades'),
            usdtBalance: document.getElementById('usdtBalance'),
            
            // Tokens
            tokenAddress: document.getElementById('tokenAddress'),
            tradeSize: document.getElementById('tradeSize'),
            minProfit: document.getElementById('minProfit'),
            maxSlippage: document.getElementById('maxSlippage'),
            addToken: document.getElementById('addToken'),
            analyzeToken: document.getElementById('analyzeToken'),
            activeTokens: document.getElementById('activeTokens'),
            
            // Controle
            gasMultiplier: document.getElementById('gasMultiplier'),
            startBot: document.getElementById('startBot'),
            stopBot: document.getElementById('stopBot'),
            manualRun: document.getElementById('manualRun'),
            botStatus: document.getElementById('botStatus'),
            
            // Fundos
            fundAmount: document.getElementById('fundAmount'),
            addFunds: document.getElementById('addFunds'),
            withdrawFunds: document.getElementById('withdrawFunds'),
            approveUSDT: document.getElementById('approveUSDT'),
            
            // Monitor
            monitorDisplay: document.getElementById('monitorDisplay'),
            monitorStats: document.getElementById('monitorStats'),
            
            // Logs
            logs: document.getElementById('logs'),
            clearLogs: document.getElementById('clearLogs')
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Event listeners
            elements.connectWallet.addEventListener('click', connectWallet);
            elements.addToken.addEventListener('click', addToken);
            elements.analyzeToken.addEventListener('click', analyzeToken);
            elements.startBot.addEventListener('click', startBot);
            elements.stopBot.addEventListener('click', stopBot);
            elements.manualRun.addEventListener('click', executeManual);
            elements.addFunds.addEventListener('click', addFunds);
            elements.withdrawFunds.addEventListener('click', withdrawFunds);
            elements.approveUSDT.addEventListener('click', () => approveToken('USDT', USDT_ADDRESS));
            elements.clearLogs.addEventListener('click', () => elements.logs.innerHTML = '');
            
            addLog('Sistema inicializado. Conecte sua carteira para come√ßar.', 'info');
        });

        // Fun√ß√µes de utilidade
        function toWei(amount) { 
            return web3 ? web3.utils.toWei(amount.toString(), 'ether') : '0'; 
        }
        
        function fromWei(amount) { 
            return web3 ? web3.utils.fromWei(amount.toString(), 'ether') : '0'; 
        }

        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    web3 = new Web3(window.ethereum);
                    userAccount = (await web3.eth.getAccounts())[0];
                    
                    elements.walletStatus.textContent = `Conectado: ${userAccount.substring(0, 8)}...`;
                    elements.walletStatus.className = 'status-badge status-active';
                    
                    contract = new web3.eth.Contract(contractABI, contractAddress);
                    
                    addLog('‚úÖ Carteira conectada com sucesso', 'success');
                    await updateAllInfo();
                    await loadActiveTokens();
                    
                } catch (error) {
                    addLog(`‚ùå Erro na conex√£o: ${error.message}`, 'error');
                }
            } else {
                addLog('‚ùå MetaMask n√£o encontrado!', 'error');
            }
        }

        async function addToken() {
            const tokenAddress = elements.tokenAddress.value;
            const tradeSize = elements.tradeSize.value;
            const minProfit = elements.minProfit.value;
            const maxSlippage = elements.maxSlippage.value;
            
            if (!web3.utils.isAddress(tokenAddress)) {
                addLog('‚ùå Endere√ßo de token inv√°lido', 'error');
                return;
            }
            
            try {
                addLog(`üí∞ Adicionando token ${tokenAddress.substring(0, 10)}...`, 'info');
                
                await contract.methods.addToken(
                    tokenAddress,
                    toWei(tradeSize),
                    toWei(minProfit),
                    maxSlippage
                ).send({ from: userAccount });
                
                addLog('‚úÖ Token adicionado com sucesso!', 'success');
                await loadActiveTokens();
                
            } catch (error) {
                addLog(`‚ùå Erro ao adicionar token: ${error.message}`, 'error');
            }
        }

        async function analyzeToken() {
            const tokenAddress = elements.tokenAddress.value;
            const tradeSize = elements.tradeSize.value;
            
            if (!web3.utils.isAddress(tokenAddress)) {
                addLog('‚ùå Endere√ßo de token inv√°lido', 'error');
                return;
            }
            
            try {
                addLog(`üîç Analisando oportunidade para o token...`, 'info');
                
                const [expectedProfit, expectedSlippage, profitable] = await contract.methods.analyzeOpportunity(
                    tokenAddress, 
                    toWei(tradeSize)
                ).call();
                
                const profit = fromWei(expectedProfit);
                const slippage = expectedSlippage / 100; // Convert to percentage
                
                if (profitable) {
                    addLog(`üí∞ Oportunidade detectada! Lucro esperado: ${profit} USDT (${slippage.toFixed(2)}%)`, 'success');
                } else {
                    addLog('‚ö†Ô∏è Sem oportunidades lucrativas no momento', 'warning');
                }
                
            } catch (error) {
                addLog(`‚ùå Erro na an√°lise: ${error.message}`, 'error');
            }
        }

        async function startBot() {
            if (!contract) {
                addLog('‚ùå Conecte a carteira primeiro', 'error');
                return;
            }
            
            isBotRunning = true;
            elements.startBot.disabled = true;
            elements.stopBot.disabled = false;
            elements.botStatus.textContent = 'ATIVO';
            elements.botStatus.className = 'status-badge status-active';
            
            addLog('ü§ñ Bot iniciado - Monitorando mempool...', 'success');
            
            // Simular monitoramento (em produ√ß√£o seria WebSocket real)
            botInterval = setInterval(simulateMempoolMonitoring, 5000);
        }

        function stopBot() {
            isBotRunning = false;
            elements.startBot.disabled = false;
            elements.stopBot.disabled = true;
            elements.botStatus.textContent = 'INATIVO';
            elements.botStatus.className = 'status-badge status-inactive';
            
            if (botInterval) {
                clearInterval(botInterval);
            }
            
            addLog('‚èπÔ∏è Bot parado', 'warning');
        }

        async function executeManual() {
            if (activeTokensList.length === 0) {
                addLog('‚ùå Nenhum token configurado', 'error');
                return;
            }
            
            const tokenAddress = activeTokensList[0]; // Usa o primeiro token ativo
            const gasMultiplier = elements.gasMultiplier.value;
            
            try {
                addLog(`‚ö° Executando front-run manual...`, 'info');
                
                const currentGasPrice = await web3.eth.getGasPrice();
                const frontRunGasPrice = Math.floor(currentGasPrice * gasMultiplier);
                
                const result = await contract.methods.executeFrontRun(
                    tokenAddress,
                    frontRunGasPrice
                ).send({ 
                    from: userAccount,
                    gasPrice: frontRunGasPrice
                });
                
                if (result.events.FrontRunExecuted) {
                    const profit = fromWei(result.events.FrontRunExecuted.returnValues.profit);
                    addLog(`‚úÖ Front-run executado! Lucro: ${profit} USDT`, 'success');
                }
                
                await updateAllInfo();
                
            } catch (error) {
                addLog(`‚ùå Erro no front-run: ${error.message}`, 'error');
            }
        }

        // Simula√ß√£o de monitoramento (substituir por WebSocket real)
        async function simulateMempoolMonitoring() {
            if (!isBotRunning || activeTokensList.length === 0) return;
            
            const simulatedTxs = [
                { 
                    hash: '0x' + Math.random().toString(16).substr(2, 64), 
                    token: activeTokensList[0],
                    value: (Math.random() * 5).toFixed(2) + ' BNB',
                    type: 'Compra Grande',
                    opportunity: 'ALTA'
                }
            ];
            
            detectedTransactions++;
            elements.monitorStats.textContent = `Transa√ß√µes detectadas: ${detectedTransactions}`;
            
            simulatedTxs.forEach(tx => {
                const txElement = document.createElement('div');
                txElement.className = 'monitor-item';
                txElement.innerHTML = `
                    <strong>${tx.type}</strong> - ${tx.value} - ${tx.opportunity}<br>
                    <small>Token: ${tx.token.substring(0, 10)}... | Hash: ${tx.hash.substring(0, 16)}...</small>
                    <button onclick="executeFrontRunForToken('${tx.token}')" style="float: right; padding: 4px 8px; font-size: 10px; background: var(--success); color: white; border: none; border-radius: 4px; cursor: pointer;">Executar</button>
                `;
                elements.monitorDisplay.appendChild(txElement);
            });
            
            // Manter apenas √∫ltimas transa√ß√µes
            while (elements.monitorDisplay.children.length > 10) {
                elements.monitorDisplay.removeChild(elements.monitorDisplay.firstChild);
            }
            
            elements.monitorDisplay.scrollTop = elements.monitorDisplay.scrollHeight;
        }

        // Fun√ß√£o global para execu√ß√£o via monitor
        window.executeFrontRunForToken = async function(tokenAddress) {
            const gasMultiplier = elements.gasMultiplier.value;
            
            try {
                addLog(`‚ö° Executando front-run para token ${tokenAddress.substring(0, 10)}...`, 'info');
                
                const currentGasPrice = await web3.eth.getGasPrice();
                const frontRunGasPrice = Math.floor(currentGasPrice * gasMultiplier);
                
                const result = await contract.methods.executeFrontRun(
                    tokenAddress,
                    frontRunGasPrice
                ).send({ 
                    from: userAccount,
                    gasPrice: frontRunGasPrice
                });
                
                if (result.events.FrontRunExecuted) {
                    const profit = fromWei(result.events.FrontRunExecuted.returnValues.profit);
                    addLog(`‚úÖ Front-run executado! Lucro: ${profit} USDT`, 'success');
                }
                
                await updateAllInfo();
                
            } catch (error) {
                addLog(`‚ùå Erro no front-run: ${error.message}`, 'error');
            }
        };

        async function loadActiveTokens() {
            if (!contract) return;
            
            try {
                const tokens = await contract.methods.getActiveTokens().call();
                activeTokensList = tokens;
                
                elements.activeTokens.innerHTML = '';
                
                if (tokens.length === 0) {
                    elements.activeTokens.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">Nenhum token ativo</div>';
                    return;
                }
                
                for (const tokenAddress of tokens) {
                    const config = await contract.methods.getTokenConfig(tokenAddress).call();
                    
                    const tokenElement = document.createElement('div');
                    tokenElement.className = 'token-item';
                    tokenElement.innerHTML = `
                        <div>
                            <strong>${tokenAddress.substring(0, 8)}...${tokenAddress.substring(36)}</strong><br>
                            <small>Trade: ${fromWei(config.tradeSizeUSDT)} USDT | Min: ${fromWei(config.minProfitUSDT)} USDT</small>
                        </div>
                        <button onclick="removeToken('${tokenAddress}')" style="background: var(--danger); color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">Remover</button>
                    `;
                    elements.activeTokens.appendChild(tokenElement);
                }
                
            } catch (error) {
                console.error('Erro ao carregar tokens:', error);
            }
        }

        window.removeToken = async function(tokenAddress) {
            try {
                addLog(`üóëÔ∏è Removendo token...`, 'info');
                await contract.methods.removeToken(tokenAddress).send({ from: userAccount });
                addLog('‚úÖ Token removido com sucesso!', 'success');
                await loadActiveTokens();
            } catch (error) {
                addLog(`‚ùå Erro ao remover token: ${error.message}`, 'error');
            }
        };

        async function addFunds() {
            const amount = elements.fundAmount.value;
            
            try {
                addLog(`üí∞ Adicionando ${amount} USDT...`, 'info');
                await contract.methods.addUSDT(toWei(amount)).send({ from: userAccount });
                addLog('‚úÖ USDT adicionado com sucesso!', 'success');
                await updateAllInfo();
            } catch (error) {
                addLog(`‚ùå Erro ao adicionar fundos: ${error.message}`, 'error');
            }
        }

        async function withdrawFunds() {
            const amount = elements.fundAmount.value;
            
            try {
                addLog(`üè¶ Retirando ${amount} USDT...`, 'info');
                await contract.methods.withdrawUSDT(toWei(amount)).send({ from: userAccount });
                addLog('‚úÖ USDT retirado com sucesso!', 'success');
                await updateAllInfo();
            } catch (error) {
                addLog(`‚ùå Erro ao retirar fundos: ${error.message}`, 'error');
            }
        }

        async function approveToken(tokenName, tokenAddress) {
            try {
                const tokenABI = [
                    {
                        "constant": false,
                        "inputs": [
                            {"name": "spender", "type": "address"},
                            {"name": "value", "type": "uint256"}
                        ],
                        "name": "approve",
                        "outputs": [{"name": "", "type": "bool"}],
                        "type": "function"
                    }
                ];
                
                const tokenContract = new web3.eth.Contract(tokenABI, tokenAddress);
                const amount = toWei('1000000'); // 1 milh√£o
                
                addLog(`üîè Aprovando ${tokenName}...`, 'info');
                await tokenContract.methods.approve(contractAddress, amount).send({ from: userAccount });
                addLog(`‚úÖ ${tokenName} aprovado com sucesso!`, 'success');
                
            } catch (error) {
                addLog(`‚ùå Erro ao aprovar ${tokenName}: ${error.message}`, 'error');
            }
        }

        async function updateAllInfo() {
            if (!contract || !web3) return;
            
            try {
                const [totalProfit, totalTrades, successRate, usdtBalance] = await contract.methods.getStats().call();
                
                elements.totalProfit.textContent = `${fromWei(totalProfit)} USDT`;
                elements.totalTrades.textContent = totalTrades;
                elements.successRate.textContent = `${(successRate / 100).toFixed(2)}%`;
                elements.usdtBalance.textContent = `${fromWei(usdtBalance)}`;
                
                // Atualizar info da carteira
                if (userAccount) {
                    const usdtContract = new web3.eth.Contract([
                        {"constant": true, "inputs": [{"name": "account", "type": "address"}], "name": "balanceOf", "outputs": [{"name": "", "type": "uint256"}], "type": "function"}
                    ], USDT_ADDRESS);
                    
                    const walletUSDT = await usdtContract.methods.balanceOf(userAccount).call();
                    const bnbBalance = await web3.eth.getBalance(userAccount);
                    
                    elements.walletInfo.innerHTML = `
                        USDT: ${fromWei(walletUSDT)} | BNB: ${fromWei(bnbBalance).substring(0, 8)}
                    `;
                }
                
            } catch (error) {
                console.error('Erro ao atualizar info:', error);
            }
        }

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            elements.logs.appendChild(logEntry);
            elements.logs.scrollTop = elements.logs.scrollHeight;
        }

        // Atualizar informa√ß√µes periodicamente
        setInterval(() => {
            if (userAccount) updateAllInfo();
        }, 10000);
    </script>
</body>
</html>
