<!DOCTYPE html>
<html>
<head>
    <title>Balance Consolidator NFT - BSC</title>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js"></script>
    <style>
        :root {
            --primary: #9c27b0;
            --success: #00d26a;
            --danger: #ff0080;
            --warning: #ffb800;
            --dark: #0f0f0f;
            --darker: #0a0a0a;
            --light: #1a1a1a;
            --lighter: #2d2d2d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--dark);
            color: #fff;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary), #ba68c8);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: var(--light);
            border: 1px solid var(--lighter);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--lighter);
        }
        
        .card h3 {
            color: var(--primary);
            font-size: 1.3em;
            margin: 0;
        }
        
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn:hover {
            background: #7b1fa2;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-warning {
            background: var(--warning);
            color: #000;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #ccc;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            background: var(--darker);
            border: 1px solid var(--lighter);
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: var(--lighter);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-success { color: var(--success); }
        .stat-warning { color: var(--warning); }
        .stat-danger { color: var(--danger); }
        .stat-primary { color: var(--primary); }
        
        .log {
            background: var(--darker);
            padding: 15px;
            border-radius: 8px;
            height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .log-entry {
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 5px;
            border-left: 4px solid var(--primary);
        }
        
        .log-success { border-left-color: var(--success); background: rgba(0,210,106,0.1); }
        .log-error { border-left-color: var(--danger); background: rgba(255,0,128,0.1); }
        .log-warning { border-left-color: var(--warning); background: rgba(255,184,0,0.1); }
        .log-info { border-left-color: #2196F3; background: rgba(33,150,243,0.1); }
        
        .wallet-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .wallet-item {
            background: var(--lighter);
            padding: 15px;
            margin: 8px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .balance-item {
            background: var(--darker);
            padding: 12px;
            margin: 6px 0;
            border-radius: 6px;
            border-left: 3px solid var(--primary);
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .status-active { background: var(--success); color: #000; }
        .status-inactive { background: var(--danger); color: #fff; }
        
        .nft-badge {
            background: linear-gradient(135deg, #9c27b0, #673ab7);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: bold;
        }
        
        .config-status {
            background: var(--darker);
            padding: 12px;
            border-radius: 6px;
            border-left: 3px solid var(--warning);
            margin: 10px 0;
        }
        
        .config-status.success {
            border-left-color: var(--success);
            background: rgba(0,210,106,0.1);
        }
        
        .config-status.error {
            border-left-color: var(--danger);
            background: rgba(255,0,128,0.1);
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üé¥ Balance Consolidator NFT - BSC</h1>
            <p>Sistema de consolida√ß√£o autom√°tica com NFT de autoriza√ß√£o</p>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div>Total Consolidado</div>
                <div class="stat-value stat-success" id="totalConsolidated">0 USDT</div>
                <div>Valor Total</div>
            </div>
            <div class="stat-card">
                <div>Carteiras Autorizadas</div>
                <div class="stat-value stat-primary" id="authorizedWallets">0</div>
                <div>Via NFT</div>
            </div>
            <div class="stat-card">
                <div>Opera√ß√µes</div>
                <div class="stat-value stat-warning" id="totalOperations">0</div>
                <div>Realizadas</div>
            </div>
            <div class="stat-card">
                <div>Saldo Contrato</div>
                <div class="stat-value stat-success" id="contractBalance">0 USDT</div>
                <div>Dispon√≠vel</div>
            </div>
        </div>

        <div class="grid">
            <!-- Coluna Esquerda -->
            <div>
                <!-- Conex√£o e Status -->
                <div class="card">
                    <div class="card-header">
                        <h3>üîó Conex√£o & Status</h3>
                    </div>
                    <button class="btn" id="connectWallet">Conectar MetaMask</button>
                    <span id="walletStatus" class="status-badge status-inactive">Desconectado</span>
                    
                    <div class="form-group" style="margin-top: 15px;">
                        <div id="walletInfo" style="font-size: 12px; color: #ccc;"></div>
                    </div>
                </div>

                <!-- Configura√ß√£o do Sistema -->
                <div class="card">
                    <div class="card-header">
                        <h3>‚öôÔ∏è Configura√ß√£o do Sistema</h3>
                    </div>
                    <div class="form-group">
                        <label>Status da Configura√ß√£o:</label>
                        <div id="setupStatus" class="config-status">
                            ‚ö†Ô∏è Sistema n√£o configurado
                        </div>
                    </div>
                    <button class="btn btn-warning" id="setupConsolidator">Configurar Rela√ß√£o NFT‚ÜíContrato</button>
                    <button class="btn" id="verifySetup">Verificar Configura√ß√£o</button>
                </div>

                <!-- Gerenciar NFTs de Autoriza√ß√£o -->
                <div class="card">
                    <div class="card-header">
                        <h3>üé¥ Gerenciar Autoriza√ß√µes NFT</h3>
                    </div>
                    <div class="form-group">
                        <label>Endere√ßo da Carteira:</label>
                        <input type="text" id="nftWalletAddress" placeholder="0x..." style="font-family: monospace;">
                    </div>
                    <div class="form-group">
                        <label>M√∫ltiplas Carteiras (separadas por v√≠rgula):</label>
                        <textarea id="multipleWallets" placeholder="0x123...,0x456..." style="width: 100%; height: 80px; padding: 12px; background: var(--darker); border: 1px solid var(--lighter); border-radius: 8px; color: #fff;"></textarea>
                    </div>
                    <button class="btn btn-success" id="mintAuthNFT">Emitir NFT √önico</button>
                    <button class="btn btn-warning" id="mintMultipleNFTs">Emitir M√∫ltiplos NFTs</button>
                    <button class="btn" id="checkNFTAuthorization">Verificar Autoriza√ß√£o</button>
                    
                    <div style="margin-top: 15px;">
                        <label>Status NFT:</label>
                        <div id="nftStatus" class="status-badge status-inactive">N√ÉO VERIFICADO</div>
                    </div>
                </div>
            </div>

            <!-- Coluna Direita -->
            <div>
                <!-- Carteiras Autorizadas -->
                <div class="card">
                    <div class="card-header">
                        <h3>üìã Carteiras Autorizadas</h3>
                        <button class="btn" id="refreshWallets">Atualizar</button>
                    </div>
                    <div class="wallet-list" id="authorizedWalletsList">
                        <!-- Carteiras ser√£o listadas aqui -->
                    </div>
                </div>

                <!-- Controle de Consolida√ß√£o -->
                <div class="card">
                    <div class="card-header">
                        <h3>üîÑ Controle de Consolida√ß√£o</h3>
                    </div>
                    <div class="form-group">
                        <label>Carteira para Consolidar:</label>
                        <select id="consolidateWallet">
                            <option value="all">TODAS AS CARTEIRAS</option>
                            <!-- Op√ß√µes preenchidas via JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Token para Consolidar:</label>
                        <select id="consolidateToken">
                            <option value="all">TODOS OS STABLECOINS</option>
                            <option value="USDT">USDT</option>
                            <option value="BUSD">BUSD</option>
                            <option value="USDC">USDC</option>
                        </select>
                    </div>
                    <button class="btn btn-success" id="consolidateBtn">Executar Consolida√ß√£o</button>
                    <button class="btn btn-warning" id="consolidateMultiple">Consolidar M√∫ltiplas</button>
                    
                    <div style="margin-top: 15px;">
                        <label>Status:</label>
                        <div id="consolidationStatus" class="status-badge status-inactive">AGUARDANDO</div>
                    </div>
                </div>

                <!-- Gerenciar Fundos -->
                <div class="card">
                    <div class="card-header">
                        <h3>üè¶ Gerenciar Fundos</h3>
                    </div>
                    <div class="form-group">
                        <label>Token para Retirar:</label>
                        <select id="withdrawToken">
                            <option value="USDT">USDT</option>
                            <option value="BUSD">BUSD</option>
                            <option value="USDC">USDC</option>
                            <option value="ALL">TODOS OS TOKENS</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Quantidade (deixe vazio para retirar tudo):</label>
                        <input type="number" id="withdrawAmount" placeholder="Quantidade espec√≠fica">
                    </div>
                    <button class="btn btn-success" id="withdrawFunds">Retirar Fundos</button>
                    <button class="btn btn-warning" id="withdrawAll">Retirar Tudo</button>
                </div>

                <!-- Informa√ß√µes do Contrato -->
                <div class="card">
                    <div class="card-header">
                        <h3>üìä Informa√ß√µes do Sistema</h3>
                    </div>
                    <div id="contractInfo" style="height: 200px; overflow-y: auto;">
                        <div class="balance-item">
                            <strong>Contrato Principal:</strong> 
                            <span id="mainContractAddress" style="font-family: monospace; font-size: 12px;">-</span>
                        </div>
                        <div class="balance-item">
                            <strong>Contrato NFT:</strong> 
                            <span id="nftContractAddress" style="font-family: monospace; font-size: 12px;">-</span>
                        </div>
                        <div class="balance-item">
                            <strong>Total NFTs Emitidos:</strong> 
                            <span id="totalNFTs">0</span>
                        </div>
                    </div>
                    <div style="margin-top: 10px;">
                        <button class="btn" id="refreshAll">Atualizar Tudo</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logs -->
        <div class="card">
            <div class="card-header">
                <h3>üìù Logs de Execu√ß√£o</h3>
                <button class="btn" id="clearLogs">Limpar Logs</button>
            </div>
            <div class="log" id="logs"></div>
        </div>
    </div>

    <script>
        // ABI do Contrato NFT
        const nftABI = [
            {
                "inputs": [],
                "stateMutability": "nonpayable",
                "type": "constructor"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "owner",
                        "type": "address"
                    },
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "approved",
                        "type": "address"
                    },
                    {
                        "indexed": true,
                        "internalType": "uint256",
                        "name": "tokenId",
                        "type": "uint256"
                    }
                ],
                "name": "Approval",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "owner",
                        "type": "address"
                    },
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "operator",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "bool",
                        "name": "approved",
                        "type": "bool"
                    }
                ],
                "name": "ApprovalForAll",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "wallet",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "tokenId",
                        "type": "uint256"
                    }
                ],
                "name": "AuthorizationRevoked",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "wallet",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "tokenId",
                        "type": "uint256"
                    }
                ],
                "name": "WalletAuthorized",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "newConsolidator",
                        "type": "address"
                    }
                ],
                "name": "ConsolidatorUpdated",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "previousOwner",
                        "type": "address"
                    },
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "newOwner",
                        "type": "address"
                    }
                ],
                "name": "OwnershipTransferred",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "from",
                        "type": "address"
                    },
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "to",
                        "type": "address"
                    },
                    {
                        "indexed": true,
                        "internalType": "uint256",
                        "name": "tokenId",
                        "type": "uint256"
                    }
                ],
                "name": "Transfer",
                "type": "event"
            },
            {
                "inputs": [],
                "name": "BUSD",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "USDC",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "USDT",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "to",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "tokenId",
                        "type": "uint256"
                    }
                ],
                "name": "approve",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_wallet",
                        "type": "address"
                    }
                ],
                "name": "authorizeWallet",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address[]",
                        "name": "_wallets",
                        "type": "address[]"
                    }
                ],
                "name": "authorizeMultipleWallets",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "name": "authorizedWallets",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "owner",
                        "type": "address"
                    }
                ],
                "name": "balanceOf",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "balanceConsolidator",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "baseTokenURI",
                "outputs": [
                    {
                        "internalType": "string",
                        "name": "",
                        "type": "string"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "tokenId",
                        "type": "uint256"
                    }
                ],
                "name": "getApproved",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getAllAuthorizedWallets",
                "outputs": [
                    {
                        "internalType": "address[]",
                        "name": "",
                        "type": "address[]"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "_tokenId",
                        "type": "uint256"
                    }
                ],
                "name": "getWalletByTokenId",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_wallet",
                        "type": "address"
                    }
                ],
                "name": "getTokenIdByWallet",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "owner",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "operator",
                        "type": "address"
                    }
                ],
                "name": "isApprovedForAll",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_wallet",
                        "type": "address"
                    }
                ],
                "name": "isWalletAuthorized",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "name",
                "outputs": [
                    {
                        "internalType": "string",
                        "name": "",
                        "type": "string"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "owner",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "tokenId",
                        "type": "uint256"
                    }
                ],
                "name": "ownerOf",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_wallet",
                        "type": "address"
                    }
                ],
                "name": "revokeAuthorization",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "from",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "to",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "tokenId",
                        "type": "uint256"
                    }
                ],
                "name": "safeTransferFrom",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "from",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "to",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "tokenId",
                        "type": "uint256"
                    },
                    {
                        "internalType": "bytes",
                        "name": "data",
                        "type": "bytes"
                    }
                ],
                "name": "safeTransferFrom",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "operator",
                        "type": "address"
                    },
                    {
                        "internalType": "bool",
                        "name": "approved",
                        "type": "bool"
                    }
                ],
                "name": "setApprovalForAll",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "string",
                        "name": "_baseTokenURI",
                        "type": "string"
                    }
                ],
                "name": "setBaseURI",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_consolidator",
                        "type": "address"
                    }
                ],
                "name": "setConsolidator",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "bytes4",
                        "name": "interfaceId",
                        "type": "bytes4"
                    }
                ],
                "name": "supportsInterface",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "symbol",
                "outputs": [
                    {
                        "internalType": "string",
                        "name": "",
                        "type": "string"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "tokenId",
                        "type": "uint256"
                    }
                ],
                "name": "tokenURI",
                "outputs": [
                    {
                        "internalType": "string",
                        "name": "",
                        "type": "string"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "totalAuthorizations",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "from",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "to",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "tokenId",
                        "type": "uint256"
                    }
                ],
                "name": "transferFrom",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ];

        // ABI do Contrato Principal
        const mainABI = [
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_authorizerNFT",
                        "type": "address"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "constructor"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "user",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "totalTokens",
                        "type": "uint256"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "totalValue",
                        "type": "uint256"
                    }
                ],
                "name": "BulkConsolidation",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "newAuthorizerNFT",
                        "type": "address"
                    }
                ],
                "name": "ConsolidatorUpdated",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "token",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "FundsWithdrawn",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "token",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    },
                    {
                        "indexed": false,
                        "internalType": "address",
                        "name": "fromWallet",
                        "type": "address"
                    }
                ],
                "name": "TokensConsolidated",
                "type": "event"
            },
            {
                "inputs": [],
                "name": "BUSD",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "USDC",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "USDT",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "authorizerNFT",
                "outputs": [
                    {
                        "internalType": "contract IAuthorizerNFT",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address[]",
                        "name": "_wallets",
                        "type": "address[]"
                    }
                ],
                "name": "consolidateMultipleWallets",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_wallet",
                        "type": "address"
                    }
                ],
                "name": "consolidateStablecoinsFromWallet",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_wallet",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "_token",
                        "type": "address"
                    }
                ],
                "name": "consolidateTokensFromWallet",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_token",
                        "type": "address"
                    }
                ],
                "name": "getContractBalance",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getStats",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "totalConsolidatedValue",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "totalOps",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "contractUSDT",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_wallet",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "_token",
                        "type": "address"
                    }
                ],
                "name": "getWalletBalance",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_wallet",
                        "type": "address"
                    }
                ],
                "name": "isWalletAuthorized",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "owner",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "totalConsolidated",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "totalOperations",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_authorizerNFT",
                        "type": "address"
                    }
                ],
                "name": "updateAuthorizerNFT",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_token",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "_amount",
                        "type": "uint256"
                    }
                ],
                "name": "withdrawFunds",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "withdrawAllFunds",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "stateMutability": "payable",
                "type": "receive"
            }
        ];

        // Endere√ßos dos contratos
        const NFT_CONTRACT_ADDRESS = "0xbE3cC9cca3b7C4af920c0372692B1C14Be0B27C0";
        const MAIN_CONTRACT_ADDRESS = "0xb45159C8f361d9672503a9929b2f1b53c48Fa5C0";
        
        // Endere√ßos dos tokens
        const TOKENS = {
            USDT: "0x55d398326f99059fF775485246999027B3197955",
            BUSD: "0xe9e7CEA3DedcA5984780Bafc599bD69ADd087D56",
            USDC: "0x8AC76a51cc950d9822D68b83fE1Ad97B32Cd580d"
        };

        let web3, nftContract, mainContract, userAccount;
        let authorizedWallets = [];

        // Elementos da UI
        const elements = {
            connectWallet: document.getElementById('connectWallet'),
            walletStatus: document.getElementById('walletStatus'),
            walletInfo: document.getElementById('walletInfo'),
            
            // Stats
            totalConsolidated: document.getElementById('totalConsolidated'),
            authorizedWallets: document.getElementById('authorizedWallets'),
            totalOperations: document.getElementById('totalOperations'),
            contractBalance: document.getElementById('contractBalance'),
            
            // Configura√ß√£o
            setupConsolidator: document.getElementById('setupConsolidator'),
            verifySetup: document.getElementById('verifySetup'),
            setupStatus: document.getElementById('setupStatus'),
            
            // NFT
            nftWalletAddress: document.getElementById('nftWalletAddress'),
            multipleWallets: document.getElementById('multipleWallets'),
            mintAuthNFT: document.getElementById('mintAuthNFT'),
            mintMultipleNFTs: document.getElementById('mintMultipleNFTs'),
            checkNFTAuthorization: document.getElementById('checkNFTAuthorization'),
            nftStatus: document.getElementById('nftStatus'),
            
            // Wallets
            authorizedWalletsList: document.getElementById('authorizedWalletsList'),
            refreshWallets: document.getElementById('refreshWallets'),
            
            // Consolida√ß√£o
            consolidateWallet: document.getElementById('consolidateWallet'),
            consolidateToken: document.getElementById('consolidateToken'),
            consolidateBtn: document.getElementById('consolidateBtn'),
            consolidateMultiple: document.getElementById('consolidateMultiple'),
            consolidationStatus: document.getElementById('consolidationStatus'),
            
            // Fundos
            withdrawToken: document.getElementById('withdrawToken'),
            withdrawAmount: document.getElementById('withdrawAmount'),
            withdrawFunds: document.getElementById('withdrawFunds'),
            withdrawAll: document.getElementById('withdrawAll'),
            
            // Info
            mainContractAddress: document.getElementById('mainContractAddress'),
            nftContractAddress: document.getElementById('nftContractAddress'),
            totalNFTs: document.getElementById('totalNFTs'),
            refreshAll: document.getElementById('refreshAll'),
            
            // Logs
            logs: document.getElementById('logs'),
            clearLogs: document.getElementById('clearLogs')
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar endere√ßos dos contratos
            elements.mainContractAddress.textContent = MAIN_CONTRACT_ADDRESS;
            elements.nftContractAddress.textContent = NFT_CONTRACT_ADDRESS;
            
            // Event listeners
            elements.connectWallet.addEventListener('click', connectWallet);
            elements.setupConsolidator.addEventListener('click', setupConsolidator);
            elements.verifySetup.addEventListener('click', verifySetup);
            elements.mintAuthNFT.addEventListener('click', mintAuthNFT);
            elements.mintMultipleNFTs.addEventListener('click', mintMultipleNFTs);
            elements.checkNFTAuthorization.addEventListener('click', checkNFTAuthorization);
            elements.refreshWallets.addEventListener('click', loadAuthorizedWallets);
            elements.consolidateBtn.addEventListener('click', executeConsolidation);
            elements.consolidateMultiple.addEventListener('click', consolidateMultipleWallets);
            elements.withdrawFunds.addEventListener('click', withdrawFunds);
            elements.withdrawAll.addEventListener('click', withdrawAllFunds);
            elements.refreshAll.addEventListener('click', updateAllInfo);
            elements.clearLogs.addEventListener('click', () => elements.logs.innerHTML = '');
            
            addLog('Sistema NFT de consolida√ß√£o inicializado.', 'info');
            addLog('Conecte sua carteira e configure o sistema.', 'info');
        });

        // Fun√ß√µes de utilidade
        function toWei(amount) { 
            return web3 ? web3.utils.toWei(amount.toString(), 'ether') : '0'; 
        }
        
        function fromWei(amount) { 
            return web3 ? web3.utils.fromWei(amount.toString(), 'ether') : '0'; 
        }

        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    web3 = new Web3(window.ethereum);
                    userAccount = (await web3.eth.getAccounts())[0];
                    
                    elements.walletStatus.textContent = `Conectado: ${userAccount.substring(0, 8)}...`;
                    elements.walletStatus.className = 'status-badge status-active';
                    
                    // Inicializar contratos
                    nftContract = new web3.eth.Contract(nftABI, NFT_CONTRACT_ADDRESS);
                    mainContract = new web3.eth.Contract(mainABI, MAIN_CONTRACT_ADDRESS);
                    
                    addLog('‚úÖ Carteira conectada com sucesso', 'success');
                    await updateAllInfo();
                    
                } catch (error) {
                    addLog(`‚ùå Erro na conex√£o: ${error.message}`, 'error');
                }
            } else {
                addLog('‚ùå MetaMask n√£o encontrado!', 'error');
            }
        }

        // Configurar a rela√ß√£o entre NFT e Contrato Principal (CR√çTICO)
        async function setupConsolidator() {
            try {
                addLog('‚öôÔ∏è Configurando rela√ß√£o NFT ‚Üí Contrato...', 'info');
                
                await nftContract.methods.setConsolidator(MAIN_CONTRACT_ADDRESS).send({ 
                    from: userAccount 
                });
                
                addLog('‚úÖ Rela√ß√£o configurada com sucesso! O sistema est√° pronto.', 'success');
                elements.setupStatus.innerHTML = '‚úÖ <strong>Sistema Configurado</strong><br><small>NFT ‚Üí Contrato Principal</small>';
                elements.setupStatus.className = 'config-status success';
                
            } catch (error) {
                addLog(`‚ùå Erro na configura√ß√£o: ${error.message}`, 'error');
                elements.setupStatus.innerHTML = '‚ùå <strong>Erro na Configura√ß√£o</strong>';
                elements.setupStatus.className = 'config-status error';
            }
        }

        // Verificar configura√ß√£o do sistema
        async function verifySetup() {
            try {
                const consolidator = await nftContract.methods.balanceConsolidator().call();
                const isConfigured = consolidator.toLowerCase() === MAIN_CONTRACT_ADDRESS.toLowerCase();
                
                if (isConfigured) {
                    addLog('‚úÖ Sistema configurado corretamente!', 'success');
                    elements.setupStatus.innerHTML = '‚úÖ <strong>Sistema Configurado</strong><br><small>NFT ‚Üí Contrato Principal</small>';
                    elements.setupStatus.className = 'config-status success';
                } else {
                    addLog('‚ö†Ô∏è Sistema n√£o configurado. Execute a configura√ß√£o.', 'warning');
                    elements.setupStatus.innerHTML = '‚ö†Ô∏è <strong>Sistema N√£o Configurado</strong><br><small>Execute a configura√ß√£o</small>';
                    elements.setupStatus.className = 'config-status';
                }
                
                return isConfigured;
            } catch (error) {
                addLog(`‚ùå Erro na verifica√ß√£o: ${error.message}`, 'error');
                return false;
            }
        }

        async function mintAuthNFT() {
            const walletAddress = elements.nftWalletAddress.value;
            
            if (!web3.utils.isAddress(walletAddress)) {
                addLog('‚ùå Endere√ßo de carteira inv√°lido', 'error');
                return;
            }
            
            try {
                addLog(`üé¥ Emitindo NFT para ${walletAddress.substring(0, 10)}...`, 'info');
                
                const result = await nftContract.methods.authorizeWallet(walletAddress).send({ 
                    from: userAccount 
                });
                
                const tokenId = result.events.WalletAuthorized.returnValues.tokenId;
                
                addLog(`‚úÖ NFT emitido com sucesso! Token ID: ${tokenId}`, 'success');
                
                elements.nftWalletAddress.value = '';
                await loadAuthorizedWallets();
                
            } catch (error) {
                addLog(`‚ùå Erro ao emitir NFT: ${error.message}`, 'error');
            }
        }

        async function mintMultipleNFTs() {
            const walletsText = elements.multipleWallets.value;
            const wallets = walletsText.split(',').map(w => w.trim()).filter(w => w !== '');
            
            if (wallets.length === 0) {
                addLog('‚ùå Nenhum endere√ßo v√°lido encontrado', 'error');
                return;
            }
            
            // Validar endere√ßos
            const validWallets = [];
            for (const wallet of wallets) {
                if (web3.utils.isAddress(wallet)) {
                    validWallets.push(wallet);
                } else {
                    addLog(`‚ö†Ô∏è Endere√ßo inv√°lido ignorado: ${wallet}`, 'warning');
                }
            }
            
            if (validWallets.length === 0) {
                addLog('‚ùå Nenhum endere√ßo v√°lido para processar', 'error');
                return;
            }
            
            try {
                addLog(`üé¥ Emitindo NFTs para ${validWallets.length} carteiras...`, 'info');
                
                const result = await nftContract.methods.authorizeMultipleWallets(validWallets).send({ 
                    from: userAccount 
                });
                
                addLog(`‚úÖ ${validWallets.length} NFTs emitidos com sucesso!`, 'success');
                
                elements.multipleWallets.value = '';
                await loadAuthorizedWallets();
                
            } catch (error) {
                addLog(`‚ùå Erro ao emitir m√∫ltiplos NFTs: ${error.message}`, 'error');
            }
        }

        async function checkNFTAuthorization() {
            const walletAddress = elements.nftWalletAddress.value || userAccount;
            
            if (!web3.utils.isAddress(walletAddress)) {
                addLog('‚ùå Endere√ßo de carteira inv√°lido', 'error');
                return;
            }
            
            try {
                const isAuthorized = await nftContract.methods.isWalletAuthorized(walletAddress).call();
                const hasNFT = await nftContract.methods.balanceOf(walletAddress).call();
                
                if (isAuthorized && hasNFT > 0) {
                    elements.nftStatus.textContent = 'AUTORIZADO';
                    elements.nftStatus.className = 'status-badge status-active';
                    addLog(`‚úÖ Carteira ${walletAddress.substring(0, 10)} est√° autorizada via NFT`, 'success');
                } else {
                    elements.nftStatus.textContent = 'N√ÉO AUTORIZADO';
                    elements.nftStatus.className = 'status-badge status-inactive';
                    addLog(`‚ùå Carteira ${walletAddress.substring(0, 10)} N√ÉO est√° autorizada`, 'error');
                }
                
            } catch (error) {
                addLog(`‚ùå Erro ao verificar autoriza√ß√£o: ${error.message}`, 'error');
            }
        }

        async function loadAuthorizedWallets() {
            try {
                const wallets = await nftContract.methods.getAllAuthorizedWallets().call();
                // CORRE√á√ÉO: usar string em vez de address(0)
                authorizedWallets = wallets.filter(w => w !== "0x0000000000000000000000000000000000000000");
                
                elements.authorizedWalletsList.innerHTML = '';
                elements.consolidateWallet.innerHTML = '<option value="all">TODAS AS CARTEIRAS</option>';
                
                if (authorizedWallets.length === 0) {
                    elements.authorizedWalletsList.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">Nenhuma carteira autorizada</div>';
                }
                
                for (const walletAddress of authorizedWallets) {
                    const tokenId = await nftContract.methods.getTokenIdByWallet(walletAddress).call();
                    const isAuthorized = await nftContract.methods.isWalletAuthorized(walletAddress).call();
                    
                    const walletElement = document.createElement('div');
                    walletElement.className = 'wallet-item';
                    walletElement.innerHTML = `
                        <div>
                            <strong>${walletAddress.substring(0, 8)}...${walletAddress.substring(36)}</strong>
                            <span class="nft-badge">NFT #${tokenId}</span><br>
                            <small>Token ID: ${tokenId} | Status: ${isAuthorized ? 'Ativo' : 'Inativo'}</small>
                        </div>
                        <div>
                            <button class="btn btn-danger" onclick="revokeAuthorization('${walletAddress}')" style="padding: 5px 10px; font-size: 12px;">Revogar</button>
                        </div>
                    `;
                    elements.authorizedWalletsList.appendChild(walletElement);
                    
                    // Adicionar ao dropdown
                    const option = document.createElement('option');
                    option.value = walletAddress;
                    option.textContent = `${walletAddress.substring(0, 8)}... (NFT #${tokenId})`;
                    elements.consolidateWallet.appendChild(option);
                }
                
                elements.authorizedWallets.textContent = authorizedWallets.length;
                
            } catch (error) {
                addLog(`‚ùå Erro ao carregar carteiras: ${error.message}`, 'error');
            }
        }

        async function executeConsolidation() {
            const wallet = elements.consolidateWallet.value;
            const token = elements.consolidateToken.value;
            
            if (wallet === 'all') {
                await consolidateMultipleWallets();
                return;
            }
            
            try {
                elements.consolidationStatus.textContent = 'CONSOLIDANDO...';
                elements.consolidationStatus.className = 'status-badge status-warning';
                
                let result;
                if (token === 'all') {
                    addLog(`üí∞ Consolidando stablecoins da carteira...`, 'info');
                    result = await mainContract.methods.consolidateStablecoinsFromWallet(wallet).send({ from: userAccount });
                } else {
                    const tokenAddress = TOKENS[token];
                    addLog(`ü™ô Consolidando ${token} da carteira...`, 'info');
                    result = await mainContract.methods.consolidateTokensFromWallet(wallet, tokenAddress).send({ from: userAccount });
                }
                
                const amount = result.events.TokensConsolidated ? fromWei(result.events.TokensConsolidated.returnValues.amount) : '0';
                
                addLog(`‚úÖ Consolida√ß√£o conclu√≠da! Valor: ${amount}`, 'success');
                elements.consolidationStatus.textContent = 'CONCLU√çDO';
                elements.consolidationStatus.className = 'status-badge status-success';
                
                await updateAllInfo();
                
            } catch (error) {
                addLog(`‚ùå Erro na consolida√ß√£o: ${error.message}`, 'error');
                elements.consolidationStatus.textContent = 'ERRO';
                elements.consolidationStatus.className = 'status-badge status-danger';
            }
        }

        async function consolidateMultipleWallets() {
            if (authorizedWallets.length === 0) {
                addLog('‚ùå Nenhuma carteira autorizada para consolidar', 'error');
                return;
            }
            
            try {
                elements.consolidationStatus.textContent = 'CONSOLIDANDO M√öLTIPLAS...';
                elements.consolidationStatus.className = 'status-badge status-warning';
                
                addLog(`üì¶ Consolidando ${authorizedWallets.length} carteiras...`, 'info');
                
                const result = await mainContract.methods.consolidateMultipleWallets(authorizedWallets).send({ 
                    from: userAccount 
                });
                
                addLog(`‚úÖ Consolida√ß√£o em massa conclu√≠da!`, 'success');
                elements.consolidationStatus.textContent = 'CONCLU√çDO';
                elements.consolidationStatus.className = 'status-badge status-success';
                
                await updateAllInfo();
                
            } catch (error) {
                addLog(`‚ùå Erro na consolida√ß√£o m√∫ltipla: ${error.message}`, 'error');
                elements.consolidationStatus.textContent = 'ERRO';
                elements.consolidationStatus.className = 'status-badge status-danger';
            }
        }

        async function withdrawFunds() {
            const token = elements.withdrawToken.value;
            const amount = elements.withdrawAmount.value;
            
            if (token === 'ALL') {
                await withdrawAllFunds();
                return;
            }
            
            const tokenAddress = TOKENS[token];
            
            try {
                addLog(`üè¶ Retirando ${token}...`, 'info');
                
                let tx;
                if (amount) {
                    tx = await mainContract.methods.withdrawFunds(
                        tokenAddress,
                        toWei(amount)
                    ).send({ from: userAccount });
                } else {
                    // Retirar tudo
                    const balance = await mainContract.methods.getContractBalance(tokenAddress).call();
                    tx = await mainContract.methods.withdrawFunds(
                        tokenAddress,
                        balance
                    ).send({ from: userAccount });
                }
                
                addLog(`‚úÖ ${token} retirado com sucesso!`, 'success');
                elements.withdrawAmount.value = '';
                
                await updateAllInfo();
                
            } catch (error) {
                addLog(`‚ùå Erro ao retirar fundos: ${error.message}`, 'error');
            }
        }

        async function withdrawAllFunds() {
            try {
                addLog(`üè¶ Retirando TODOS os fundos...`, 'info');
                
                await mainContract.methods.withdrawAllFunds().send({ from: userAccount });
                
                addLog(`‚úÖ Todos os fundos retirados com sucesso!`, 'success');
                
                await updateAllInfo();
                
            } catch (error) {
                addLog(`‚ùå Erro ao retirar todos os fundos: ${error.message}`, 'error');
            }
        }

        async function updateAllInfo() {
            if (!web3 || !nftContract || !mainContract) return;
            
            try {
                // Verificar configura√ß√£o primeiro
                await verifySetup();
                
                // Stats do contrato principal
                const [totalConsolidated, totalOps, contractUSDT] = await mainContract.methods.getStats().call();
                
                elements.totalConsolidated.textContent = `${fromWei(totalConsolidated)} USDT`;
                elements.totalOperations.textContent = totalOps;
                elements.contractBalance.textContent = `${fromWei(contractUSDT)} USDT`;
                
                // Info do NFT
                const totalNFTs = await nftContract.methods.totalAuthorizations().call();
                elements.totalNFTs.textContent = totalNFTs;
                
                // Info da carteira
                if (userAccount) {
                    const bnbBalance = await web3.eth.getBalance(userAccount);
                    const nftBalance = await nftContract.methods.balanceOf(userAccount).call();
                    elements.walletInfo.innerHTML = `
                        BNB: ${fromWei(bnbBalance).substring(0, 8)} | NFTs: ${nftBalance}
                    `;
                }
                
                await loadAuthorizedWallets();
                
            } catch (error) {
                console.error('Erro ao atualizar info:', error);
                addLog(`‚ö†Ô∏è Erro ao atualizar informa√ß√µes: ${error.message}`, 'warning');
            }
        }

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            elements.logs.appendChild(logEntry);
            elements.logs.scrollTop = elements.logs.scrollHeight;
        }

        // Fun√ß√µes globais
        window.revokeAuthorization = async function(walletAddress) {
            try {
                addLog(`üóëÔ∏è Revogando autoriza√ß√£o...`, 'info');
                await nftContract.methods.revokeAuthorization(walletAddress).send({ from: userAccount });
                addLog(`‚úÖ Autoriza√ß√£o revogada com sucesso`, 'success');
                await loadAuthorizedWallets();
            } catch (error) {
                addLog(`‚ùå Erro ao revogar autoriza√ß√£o: ${error.message}`, 'error');
            }
        };

        // Atualizar periodicamente
        setInterval(() => {
            if (userAccount) updateAllInfo();
        }, 30000);
    </script>
</body>
</html>
