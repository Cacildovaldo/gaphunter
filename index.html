<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liquidity Optimizer - PancakeSwap V3</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .input:focus {
            outline: none;
            border-color: #667eea;
        }

        .info-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: bold;
            color: #555;
        }

        .info-value {
            color: #333;
            font-weight: bold;
        }

        .owner-panel {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
        }

        .success {
            color: #28a745;
            font-weight: bold;
        }

        .warning {
            color: #ffc107;
            font-weight: bold;
        }

        .danger {
            color: #dc3545;
            font-weight: bold;
        }

        .connect-section {
            text-align: center;
            padding: 50px;
        }

        .big-button {
            padding: 15px 30px;
            font-size: 1.2rem;
        }

        .hidden {
            display: none;
        }

        .section-title {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .control-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Cabe√ßalho -->
        <div class="header">
            <h1>üéØ Liquidity Optimizer</h1>
            <p>Otimize seus rendimentos na PancakeSwap V3 com estrat√©gias avan√ßadas</p>
        </div>

        <!-- Se√ß√£o de Conex√£o -->
        <div id="connectSection" class="card connect-section">
            <h2>Conectar Carteira</h2>
            <p>Conecte sua MetaMask para come√ßar a investir</p>
            <button class="button big-button" onclick="connectWallet()">üîó Conectar MetaMask</button>
        </div>

        <!-- Aplica√ß√£o Principal -->
        <div id="appSection" class="hidden">
            <!-- Informa√ß√µes do Usu√°rio -->
            <div class="card">
                <h2>üë§ Meu Investimento</h2>
                <div class="grid">
                    <div class="info-panel">
                        <div class="info-row">
                            <span class="info-label">Carteira:</span>
                            <span class="info-value" id="walletAddress"></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Saldo USDT:</span>
                            <span class="info-value" id="usdtBalance">0</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Meu Investimento:</span>
                            <span class="info-value" id="myInvestment">0 USDT</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Minhas Shares:</span>
                            <span class="info-value" id="myShares">0</span>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="section-title">üí∞ Depositar USDT</h3>
                        <div class="input-group">
                            <label>Quantidade USDT:</label>
                            <input type="number" id="depositAmount" class="input" placeholder="Ex: 100" min="1">
                        </div>
                        <button class="button" onclick="deposit()" id="depositButton">üì• Depositar</button>

                        <h3 class="section-title" style="margin-top: 20px;">üí∏ Retirar</h3>
                        <div class="input-group">
                            <label>Quantidade para retirar:</label>
                            <input type="number" id="withdrawAmount" class="input" placeholder="Ex: 50" min="1">
                        </div>
                        <button class="button" onclick="withdraw()" id="withdrawButton">üì§ Retirar</button>
                    </div>
                </div>
            </div>

            <!-- Painel do Owner -->
            <div id="ownerPanel" class="card owner-panel hidden">
                <h2>üéõÔ∏è Painel de Controle (Owner)</h2>
                
                <div class="grid">
                    <div class="info-panel">
                        <h3 class="section-title">üìä Informa√ß√µes da Posi√ß√£o</h3>
                        <div class="info-row">
                            <span class="info-label">TokenId:</span>
                            <span class="info-value" id="currentTokenId">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Range Atual:</span>
                            <span class="info-value" id="currentRange">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Liquidez Total:</span>
                            <span class="info-value" id="totalLiquidity">0</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Taxas USDT:</span>
                            <span class="info-value" id="feesUSDT">0</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Taxas USDC:</span>
                            <span class="info-value" id="feesUSDC">0</span>
                        </div>
                    </div>

                    <div>
                        <h3 class="section-title">üîß Controles de Range</h3>
                        <div class="input-group">
                            <label>Ticks para expandir:</label>
                            <input type="number" id="rangeExpansion" class="input" value="50" min="1">
                        </div>
                        <div class="control-group">
                            <button class="button" onclick="ajustRangeTokenACustom()">‚è´ Expandir Para Cima</button>
                            <button class="button" onclick="ajustRangeTokenBCustom()">‚è¨ Expandir Para Baixo</button>
                        </div>

                        <h3 class="section-title">üîÑ Rebalanceamento</h3>
                        <div class="input-group">
                            <label>Novo Tick Lower:</label>
                            <input type="number" id="newTickLower" class="input" value="-200">
                        </div>
                        <div class="input-group">
                            <label>Novo Tick Upper:</label>
                            <input type="number" id="newTickUpper" class="input" value="200">
                        </div>
                        <button class="button" onclick="rebalancearRange()">üîÑ Rebalancear Range</button>
                        
                        <button class="button" onclick="coletarTaxas()" style="margin-top: 10px;">üí∏ Coletar Todas as Taxas</button>
                    </div>
                </div>
            </div>

            <!-- Informa√ß√µes do Pool -->
            <div class="card">
                <h2>üìä Estat√≠sticas do Pool</h2>
                <div class="grid">
                    <div class="info-panel">
                        <div class="info-row">
                            <span class="info-label">Total Investido:</span>
                            <span class="info-value" id="totalInvested">0 USDT</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Total de Shares:</span>
                            <span class="info-value" id="totalShares">0</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Tick Atual do Pool:</span>
                            <span class="info-value" id="currentPoolTick">0</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Posi√ß√£o Ativa:</span>
                            <span class="info-value" id="positionActive">N√£o</span>
                        </div>
                    </div>
                    <div class="info-panel">
                        <div class="info-row">
                            <span class="info-label">Rede:</span>
                            <span class="info-value">BSC Mainnet</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Pool:</span>
                            <span class="info-value">USDT/USDC 0.01%</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Contrato:</span>
                            <span class="info-value" id="contractAddress">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Status:</span>
                            <span class="info-value success" id="connectionStatus">Conectado</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== CONFIGURA√á√ïES ==========
        const CONTRACT_ADDRESS = "0xd4118361B7aDff43d7Aa7A42daC7957A52291f91"; // ‚Üê COLOCAR O ENDERE√áO DO CONTRATO DEPLOYADO
        const USDT_ADDRESS = "0x55d398326f99059fF775485246999027B3197955";
        
        // ABI COMPLETA DO CONTRATO
        const CONTRACT_ABI = [
            {
                "inputs": [],
                "stateMutability": "nonpayable",
                "type": "constructor"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": false,
                        "internalType": "address",
                        "name": "user",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "Deposited",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "tokenId",
                        "type": "uint256"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint128",
                        "name": "liquidity",
                        "type": "uint128"
                    }
                ],
                "name": "LiquidityAdded",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": false,
                        "internalType": "int24",
                        "name": "novoTickLower",
                        "type": "int24"
                    },
                    {
                        "indexed": false,
                        "internalType": "int24",
                        "name": "novoTickUpper",
                        "type": "int24"
                    }
                ],
                "name": "RangeAjustado",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "novoTokenId",
                        "type": "uint256"
                    },
                    {
                        "indexed": false,
                        "internalType": "int24",
                        "name": "tickLower",
                        "type": "int24"
                    },
                    {
                        "indexed": false,
                        "internalType": "int24",
                        "name": "tickUpper",
                        "type": "int24"
                    }
                ],
                "name": "TokenIdManipulado",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": false,
                        "internalType": "address",
                        "name": "user",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "Withdrawn",
                "type": "event"
            },
            {
                "inputs": [
                    {
                        "internalType": "int24",
                        "name": "expansao",
                        "type": "int24"
                    }
                ],
                "name": "ajustRangeTokenA",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "int24",
                        "name": "expansao",
                        "type": "int24"
                    }
                ],
                "name": "ajustRangeTokenB",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "coletarTaxas",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "int24",
                        "name": "tickLower",
                        "type": "int24"
                    },
                    {
                        "internalType": "int24",
                        "name": "tickUpper",
                        "type": "int24"
                    }
                ],
                "name": "criarNovoTokenId",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "tokenId",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "pure",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "depositUSDT",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "token",
                        "type": "address"
                    }
                ],
                "name": "emergencyWithdraw",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getCurrentTick",
                "outputs": [
                    {
                        "internalType": "int24",
                        "name": "tick",
                        "type": "int24"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getInformacoesPosicao",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "tokenId",
                        "type": "uint256"
                    },
                    {
                        "internalType": "int24",
                        "name": "tickLower",
                        "type": "int24"
                    },
                    {
                        "internalType": "int24",
                        "name": "tickUpper",
                        "type": "int24"
                    },
                    {
                        "internalType": "uint128",
                        "name": "liquidity",
                        "type": "uint128"
                    },
                    {
                        "internalType": "uint128",
                        "name": "feesUSDT",
                        "type": "uint128"
                    },
                    {
                        "internalType": "uint128",
                        "name": "feesUSDC",
                        "type": "uint128"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getRangeAtual",
                "outputs": [
                    {
                        "internalType": "int24",
                        "name": "tickLower",
                        "type": "int24"
                    },
                    {
                        "internalType": "int24",
                        "name": "tickUpper",
                        "type": "int24"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "user",
                        "type": "address"
                    }
                ],
                "name": "getUserBalance",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "POSITION_MANAGER",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "POOL",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "USDC",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "USDT",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "int24",
                        "name": "novoTickLower",
                        "type": "int24"
                    },
                    {
                        "internalType": "int24",
                        "name": "novoTickUpper",
                        "type": "int24"
                    }
                ],
                "name": "rebalancearComNovoRange",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "tokenIdAtual",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "totalLiquidity",
                "outputs": [
                    {
                        "internalType": "uint128",
                        "name": "",
                        "type": "uint128"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "totalShares",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "shareAmount",
                        "type": "uint256"
                    }
                ],
                "name": "withdraw",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "owner",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "posicaoAtiva",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "tickLowerAtual",
                "outputs": [
                    {
                        "internalType": "int24",
                        "name": "",
                        "type": "int24"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "tickUpperAtual",
                "outputs": [
                    {
                        "internalType": "int24",
                        "name": "",
                        "type": "int24"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "name": "userDeposits",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "name": "userShares",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        const USDT_ABI = [
            {
                "constant": false,
                "inputs": [
                    {"name": "_spender", "type": "address"},
                    {"name": "_value", "type": "uint256"}
                ],
                "name": "approve",
                "outputs": [{"name": "", "type": "bool"}],
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [{"name": "_owner", "type": "address"}],
                "name": "balanceOf",
                "outputs": [{"name": "balance", "type": "uint256"}],
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [
                    {"name": "_to", "type": "address"},
                    {"name": "_value", "type": "uint256"}
                ],
                "name": "transfer",
                "outputs": [{"name": "", "type": "bool"}],
                "type": "function"
            }
        ];

        // ========== VARI√ÅVEIS GLOBAIS ==========
        let web3;
        let account;
        let contract;
        let isOwner = false;

        // ========== FUN√á√ïES PRINCIPAIS ==========
        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    document.getElementById('depositButton').disabled = true;
                    document.getElementById('depositButton').textContent = 'Conectando...';
                    
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    web3 = new Web3(window.ethereum);
                    const accounts = await web3.eth.getAccounts();
                    account = accounts[0];
                    
                    // Mostrar aplica√ß√£o
                    document.getElementById('connectSection').classList.add('hidden');
                    document.getElementById('appSection').classList.remove('hidden');
                    document.getElementById('walletAddress').textContent = `${account.substring(0, 6)}...${account.substring(38)}`;
                    
                    // Inicializar contrato
                    contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                    document.getElementById('contractAddress').textContent = `${CONTRACT_ADDRESS.substring(0, 6)}...${CONTRACT_ADDRESS.substring(38)}`;
                    
                    // Verificar se √© owner
                    const contractOwner = await contract.methods.owner().call();
                    isOwner = (account.toLowerCase() === contractOwner.toLowerCase());
                    
                    if (isOwner) {
                        document.getElementById('ownerPanel').classList.remove('hidden');
                    }
                    
                    await updateAllData();
                    
                    document.getElementById('depositButton').disabled = false;
                    document.getElementById('depositButton').textContent = 'üì• Depositar';
                    
                    // Atualizar a cada 30 segundos
                    setInterval(updateAllData, 30000);
                    
                } catch (error) {
                    console.error("Erro ao conectar:", error);
                    alert("Erro ao conectar: " + error.message);
                    document.getElementById('depositButton').disabled = false;
                    document.getElementById('depositButton').textContent = 'üì• Depositar';
                }
            } else {
                alert("Por favor instale o MetaMask!");
            }
        }

        async function updateAllData() {
            await updateBalances();
            await updatePoolInfo();
            if (isOwner) {
                await updateOwnerInfo();
            }
        }

        async function updateBalances() {
            if (!web3 || !account) return;
            
            try {
                const usdtContract = new web3.eth.Contract(USDT_ABI, USDT_ADDRESS);
                const usdtBalance = await usdtContract.methods.balanceOf(account).call();
                document.getElementById('usdtBalance').textContent = (usdtBalance / 1e18).toFixed(2);
                
                const userInvestment = await contract.methods.getUserBalance(account).call();
                document.getElementById('myInvestment').textContent = (userInvestment / 1e18).toFixed(2) + ' USDT';
                
                const userShares = await contract.methods.userShares(account).call();
                document.getElementById('myShares').textContent = (userShares / 1e18).toFixed(4);
                
            } catch (error) {
                console.error("Erro ao atualizar saldos:", error);
            }
        }

        async function updatePoolInfo() {
            if (!web3) return;
            
            try {
                const totalShares = await contract.methods.totalShares().call();
                document.getElementById('totalShares').textContent = (totalShares / 1e18).toFixed(2);
                
                const totalInvested = totalShares; // Simplificado
                document.getElementById('totalInvested').textContent = (totalInvested / 1e18).toFixed(2) + ' USDT';
                
                const currentTick = await contract.methods.getCurrentTick().call();
                document.getElementById('currentPoolTick').textContent = currentTick;
                
                const posicaoAtiva = await contract.methods.posicaoAtiva().call();
                document.getElementById('positionActive').textContent = posicaoAtiva ? 'Sim' : 'N√£o';
                document.getElementById('positionActive').className = posicaoAtiva ? 'success' : 'warning';
                
            } catch (error) {
                console.error("Erro ao atualizar info do pool:", error);
            }
        }

        async function updateOwnerInfo() {
            if (!web3 || !isOwner) return;
            
            try {
                const tokenId = await contract.methods.tokenIdAtual().call();
                document.getElementById('currentTokenId').textContent = tokenId !== '0' ? tokenId : 'N√£o criado';
                
                const range = await contract.methods.getRangeAtual().call();
                document.getElementById('currentRange').textContent = `${range[0]} a ${range[1]} ticks`;
                
                const totalLiquidity = await contract.methods.totalLiquidity().call();
                document.getElementById('totalLiquidity').textContent = totalLiquidity;
                
                const posicaoInfo = await contract.methods.getInformacoesPosicao().call();
                document.getElementById('feesUSDT').textContent = posicaoInfo[4] || '0';
                document.getElementById('feesUSDC').textContent = posicaoInfo[5] || '0';
                
            } catch (error) {
                console.error("Erro ao atualizar info do owner:", error);
            }
        }

        // ========== FUN√á√ïES DE INVESTIMENTO ==========
        async function deposit() {
            const amount = document.getElementById('depositAmount').value;
            if (!amount || amount <= 0) {
                alert("Por favor digite um valor v√°lido");
                return;
            }
            
            try {
                const amountWei = web3.utils.toWei(amount.toString(), 'ether');
                const usdtContract = new web3.eth.Contract(USDT_ABI, USDT_ADDRESS);
                
                // Aprovar USDT
                document.getElementById('depositButton').disabled = true;
                document.getElementById('depositButton').textContent = 'Aprovando...';
                
                await usdtContract.methods.approve(CONTRACT_ADDRESS, amountWei).send({ from: account });
                
                // Fazer dep√≥sito
                document.getElementById('depositButton').textContent = 'Depositando...';
                await contract.methods.depositUSDT(amountWei).send({ from: account });
                
                alert("‚úÖ Dep√≥sito realizado com sucesso!");
                await updateAllData();
                
            } catch (error) {
                console.error("Erro no dep√≥sito:", error);
                alert("‚ùå Erro no dep√≥sito: " + error.message);
            } finally {
                document.getElementById('depositButton').disabled = false;
                document.getElementById('depositButton').textContent = 'üì• Depositar';
                document.getElementById('depositAmount').value = '';
            }
        }

        async function withdraw() {
            const amount = document.getElementById('withdrawAmount').value;
            if (!amount || amount <= 0) {
                alert("Por favor digite um valor v√°lido");
                return;
            }
            
            try {
                const amountWei = web3.utils.toWei(amount.toString(), 'ether');
                document.getElementById('withdrawButton').disabled = true;
                document.getElementById('withdrawButton').textContent = 'Processando...';
                
                await contract.methods.withdraw(amountWei).send({ from: account });
                
                alert("‚úÖ Saque realizado com sucesso!");
                await updateAllData();
                
            } catch (error) {
                console.error("Erro no saque:", error);
                alert("‚ùå Erro no saque: " + error.message);
            } finally {
                document.getElementById('withdrawButton').disabled = false;
                document.getElementById('withdrawButton').textContent = 'üì§ Retirar';
                document.getElementById('withdrawAmount').value = '';
            }
        }

        // ========== FUN√á√ïES DE CONTROLE DO OWNER ==========
        async function ajustRangeTokenACustom() {
            const expansao = parseInt(document.getElementById('rangeExpansion').value);
            await ajustRangeTokenA(expansao);
        }

        async function ajustRangeTokenBCustom() {
            const expansao = parseInt(document.getElementById('rangeExpansion').value);
            await ajustRangeTokenB(expansao);
        }

        async function ajustRangeTokenA(expansao) {
            try {
                await contract.methods.ajustRangeTokenA(expansao).send({ from: account });
                alert("‚úÖ Range expandido para cima!");
                await updateOwnerInfo();
            } catch (error) {
                console.error("Erro:", error);
                alert("‚ùå Erro: " + error.message);
            }
        }

        async function ajustRangeTokenB(expansao) {
            try {
                await contract.methods.ajustRangeTokenB(expansao).send({ from: account });
                alert("‚úÖ Range expandido para baixo!");
                await updateOwnerInfo();
            } catch (error) {
                console.error("Erro:", error);
                alert("‚ùå Erro: " + error.message);
            }
        }

        async function rebalancearRange() {
            const tickLower = parseInt(document.getElementById('newTickLower').value);
            const tickUpper = parseInt(document.getElementById('newTickUpper').value);
            
            try {
                await contract.methods.rebalancearComNovoRange(tickLower, tickUpper).send({ from: account });
                alert("‚úÖ Range rebalanceado com sucesso!");
                await updateOwnerInfo();
            } catch (error) {
                console.error("Erro:", error);
                alert("‚ùå Erro: " + error.message);
            }
        }

        async function coletarTaxas() {
            try {
                await contract.methods.coletarTaxas().send({ from: account });
                alert("‚úÖ Taxas coletadas com sucesso!");
                await updateOwnerInfo();
            } catch (error) {
                console.error("Erro:", error);
                alert("‚ùå Erro: " + error.message);
            }
        }

        // ========== INICIALIZA√á√ÉO ==========
        window.addEventListener('load', function() {
            if (typeof window.ethereum !== 'undefined') {
                console.log('MetaMask detectado!');
            } else {
                alert('MetaMask n√£o detectado. Por favor instale a extens√£o.');
            }
        });
    </script>
</body>
</html>
